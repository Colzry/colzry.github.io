<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.113.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.png><link rel=icon type=image/x-icon href=/imgs/icons/favicon.png><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/favicon.png><meta itemprop=name content="MyBatis教程"><meta itemprop=description content="MyBatis教程"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://colzry.github.io/imgs/avatar.jpg"><meta itemprop=keywords content="MyBatis"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis教程"><meta property="og:description" content="MyBatis教程"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://colzry.github.io/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatis%E6%95%99%E7%A8%8B/"><meta property="og:site_name" content="Colzry's Blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Colzry"><meta property="article:published_time" content="2023-06-16 16:41:30 +0800 +0800"><meta property="article:modified_time" content="2023-06-16 16:41:30 +0800 +0800"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.7efab351038eac56da41c92d9d6d38d8a9f1fc8fd6a9b17ea5982415a7b542a3.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"mybatis%E6%95%99%E7%A8%8B","permalink":"https://colzry.github.io/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatis%E6%95%99%E7%A8%8B/","title":"MyBatis教程","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>MyBatis教程 - Colzry's Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Colzry's Blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Colzry的博客</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>112</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#1-jdbc实现过程>1. JDBC实现过程</a><ul><li><a href=#11-步骤>1.1 步骤</a></li><li><a href=#12-代码>1.2 代码</a><ul><li><a href=#121-新建maven工程>1.2.1 新建maven工程</a></li><li><a href=#122-新建userjdbcdaojava>1.2.2 新建UserJDBCDao.java</a></li><li><a href=#123-新建userjdbcservicejava>1.2.3 新建USERJDBCService.java</a></li><li><a href=#124-测试用例测试>1.2.4 测试用例测试</a></li></ul></li></ul></li><li><a href=#2-jdbc问题>2. JDBC问题</a><ul><li><ul><li><a href=#21-连接获取和释放>2.1 连接获取和释放</a></li><li><a href=#22-sql统一存取>2.2 SQL统一存取</a></li><li><a href=#23-传入的参数映射和动态sql>2.3 传入的参数映射和动态sql</a></li><li><a href=#24-结果映射和结果缓存>2.4 结果映射和结果缓存</a></li><li><a href=#25-重复sql>2.5 重复sql</a></li></ul></li></ul></li><li><a href=#3-jdbc演变为mybatis>3. JDBC演变为Mybatis</a></li><li><a href=#4-mybatis的使用>4. Mybatis的使用</a><ul><li><ul><li><a href=#41-定义dao接口>4.1 定义DAO接口</a></li><li><a href=#42-建立mybatis配置文件>4.2 建立Mybatis配置文件</a></li><li><a href=#43-创建xml和dao接口对应在其中统一写sql>4.3 创建xml和DAO接口对应，在其中统一写sql</a></li><li><a href=#44-测试-并添加日志>4.4 测试 并添加日志</a></li><li><a href=#45-insert-添加实现>4.5 insert 添加实现</a></li><li><a href=#46-update-更新实现>4.6 update 更新实现</a></li><li><a href=#47-delete-删除实现>4.7 DELETE 删除实现</a></li><li><a href=#48-列表查询实现>4.8 列表查询实现</a></li><li><a href=#49-分页实现>4.9 分页实现</a></li><li><a href=#410-各种标签的使用>4.10 各种标签的使用</a></li><li><a href=#411-resultmap的使用>4.11 ResultMap的使用</a></li><li><a href=#412-事务>4.12 事务</a></li><li><a href=#413-sql注入问题>4.13 sql注入问题</a></li></ul></li></ul></li><li><a href=#5-mybatis的原理>5. Mybatis的原理</a><ul><li><ul><li></li></ul></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Colzry src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Colzry</p><div class=site-description itemprop=description>今早起来雾沉沉，我是一个抽卡人</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>112</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>18</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>57</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/Colzry title="Github → https://github.com/Colzry" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=mailto:colzry@foxmail.com title="E-Mail → mailto:colzry@foxmail.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2021-04-16T16:41:30+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=114500></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=295></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-06-16T16:41:30+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/Colzry rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://colzry.github.io/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatis%E6%95%99%E7%A8%8B/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Colzry"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Colzry"><meta itemprop=description content="今早起来雾沉沉，我是一个抽卡人"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="MyBatis教程"><meta itemprop=description content="MyBatis教程"></span><header class=post-header><h1 class=post-title itemprop="name headline">MyBatis教程</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2023-06-16 16:41:30 +0800 +0800" itemprop="dateCreated datePublished" datetime="2023-06-16 16:41:30 +0800 +0800">2023-06-16</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6 itemprop=url rel=index><span itemprop=name>框架和中间件</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>10630</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>22分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatis%E6%95%99%E7%A8%8B/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h1 id=码神之路之mybatis教程>码神之路之Mybatis教程</h1><p>ORM是什么？</p><p>为什么要将JDBC封装为Mybatis？</p><p>怎么使用Mybatis实现增删改查？</p><p>sql注入？</p><p>标签，标签，标签，标签等标签的使用?</p><p>Mybatis如何实现分页?</p><p>Mybatis分页插件的使用?</p><p>Mybatis的原理?</p><h1 id=目录>目录</h1><ol><li><p>JDBC实现过程</p></li><li><p>JDBC的问题</p></li><li><p>JDBC演变为Mybatis</p></li><li><p>Mybatis的使用</p></li><li><p>Mybatis的原理</p></li><li><p>后续讲解</p><ol><li>在spring阶段讲解和Mybatis的整合</li><li>在springboot阶段 讲解和Mybatis的整合</li><li>Mybatis-plus的使用</li></ol></li></ol><h2 id=1-jdbc实现过程>1. JDBC实现过程</h2><h3 id=11-步骤>1.1 步骤</h3><p>我们最熟悉也是最基础的通过JDBC查询数据库数据，一般需要以下七个步骤：</p><ol><li>加载JDBC驱动；</li><li>建立并获取数据库连接；</li><li>创建 JDBC Statements 对象；</li><li>设置SQL语句的传入参数；</li><li>执行SQL语句并获得查询结果；</li><li>对查询结果进行转换处理并将处理结果返回；</li><li>释放相关资源（关闭Connection，关闭Statement，关闭ResultSet）；</li></ol><h3 id=12-代码>1.2 代码</h3><h4 id=121-新建maven工程>1.2.1 新建maven工程</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;project</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;modelVersion&gt;</span>4.0.0<span style=color:#f92672>&lt;/modelVersion&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.xiaopizhu<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mybatisDemo<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.0-SNAPSHOT<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- mybatis --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.mybatis<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>3.5.6<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>mysql<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>mysql-connector-java<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>8.0.23<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!--junit --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>junit<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>junit<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>4.12<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- lombok --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>1.18.16<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>provided<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>maven-compiler-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;version&gt;</span>3.8.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;target&gt;</span>8<span style=color:#f92672>&lt;/target&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;source&gt;</span>8<span style=color:#f92672>&lt;/source&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/build&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/project&gt;</span>
</span></span></code></pre></div><h4 id=122-新建userjdbcdaojava>1.2.2 新建UserJDBCDao.java</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.xiaopizhu.mybatis.dao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.pojo.User<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.ArrayList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Collections<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserJDBCDao</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListGtAge</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> age<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        String url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;jdbc:mysql://localhost:3306/god?serverTimezone=UTC&amp;characterEncoding=utf-8&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        String name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;root&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        String password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;root&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Connection connection <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        PreparedStatement preparedStatement <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        ResultSet resultSet <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            connection <span style=color:#f92672>=</span> DriverManager<span style=color:#f92672>.</span><span style=color:#a6e22e>getConnection</span><span style=color:#f92672>(</span>url<span style=color:#f92672>,</span>name<span style=color:#f92672>,</span>password<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            String sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select * from g_user where age &gt; ?&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            preparedStatement <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span><span style=color:#a6e22e>prepareStatement</span><span style=color:#f92672>(</span>sql<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            preparedStatement<span style=color:#f92672>.</span><span style=color:#a6e22e>setInt</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span>age<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            resultSet <span style=color:#f92672>=</span> preparedStatement<span style=color:#f92672>.</span><span style=color:#a6e22e>executeQuery</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>resultSet<span style=color:#f92672>.</span><span style=color:#a6e22e>next</span><span style=color:#f92672>()){</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>long</span> id <span style=color:#f92672>=</span> resultSet<span style=color:#f92672>.</span><span style=color:#a6e22e>getLong</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                String username <span style=color:#f92672>=</span> resultSet<span style=color:#f92672>.</span><span style=color:#a6e22e>getString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> age1 <span style=color:#f92672>=</span> resultSet<span style=color:#f92672>.</span><span style=color:#a6e22e>getInt</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;age&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                user<span style=color:#f92672>.</span><span style=color:#a6e22e>setId</span><span style=color:#f92672>(</span>id<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                user<span style=color:#f92672>.</span><span style=color:#a6e22e>setUsername</span><span style=color:#f92672>(</span>username<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                user<span style=color:#f92672>.</span><span style=color:#a6e22e>setAge</span><span style=color:#f92672>(</span>age1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                userList<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Collections<span style=color:#f92672>.</span><span style=color:#a6e22e>emptyList</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>resultSet <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    resultSet<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>preparedStatement <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    preparedStatement<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>connection <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    connection<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=123-新建userjdbcservicejava>1.2.3 新建USERJDBCService.java</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.xiaopizhu.mybatis.service<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.dao.UserJDBCDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.pojo.User<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserJDBCService</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserJDBCDao userJDBCDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>UserJDBCService</span><span style=color:#f92672>(</span>UserJDBCDao userJDBCDao<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>userJDBCDao</span> <span style=color:#f92672>=</span> userJDBCDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> age<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> userJDBCDao<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListGtAge</span><span style=color:#f92672>(</span>age<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=124-测试用例测试>1.2.4 测试用例测试</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.xiaopizhu.mybatis.service<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.dao.UserJDBCDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.pojo.User<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.Before<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.Test<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserJDBCServiceTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserJDBCService userJDBCService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Before</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setup</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        userJDBCService <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UserJDBCService<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> UserJDBCDao<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserList</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userJDBCService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserList</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>userList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=2-jdbc问题>2. JDBC问题</h2><p>从上面的代码可以看出，JDBC的代码过于臃肿以及一些代码需要优化，需要进一步封装，减少开发人员的代码书写量，那么哪些代码是可以进行封装的？</p><h4 id=21-连接获取和释放>2.1 连接获取和释放</h4><ol><li>问题：数据库连接频繁的开启和关闭本身就造成了<strong>资源的浪费，影响系统的性能</strong></li><li>解决：<strong>数据库连接池</strong></li></ol><h4 id=22-sql统一存取>2.2 SQL统一存取</h4><ol><li>问题：sql散落在不同的java文件中，可读性很差，不利于维护（修改sql语句，sql调优等非常麻烦）</li><li>解决：不把sql写到java代码中，抽取出来，放入统一的一个地方，比如配置文件，使用id进行匹配</li></ol><h4 id=23-传入的参数映射和动态sql>2.3 传入的参数映射和动态sql</h4><ol><li>问题：设置占位符来达到使用传入参数的目的，按照一定顺序传入参数的，要与占位符一一匹配。但是，如果我们<strong>传入的参数是不确定的</strong>（比如列表查询，根据用户填写的查询条件不同，传入查询的参数也是不同的，有时是一个参数、有时可能是三个参数），那么我们就得<strong>在后台代码中自己根据请求的传入参数去拼凑相应的SQL语句</strong>，这样的话还是<strong>避免不了在Java代码里面写SQL语句的命运</strong>。</li><li>动态sql问题：怎么做到能够根据前台传入参数的不同，动态生成对应的SQL语句呢？</li><li>解决：第一个问题，可以用<strong>一种有别于SQL的语法来嵌入变量（比如使用＃变量名＃）</strong>，这样，SQL语句经过解析后就可以动态的生成符合上下文的SQL语句。第二个问题，可以在sql语句中，使用 这样的标签，通过特定的sql解析器来去解析，设定类似 在test中写对应的判断语句。</li></ol><h4 id=24-结果映射和结果缓存>2.4 结果映射和结果缓存</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>1. 问题：每次执行完sql语句，要从结果集获取数据，以及要对结果进行封装，要写大量的代码
</span></span><span style=display:flex><span>2. 解决：期望有一个sql处理器，只需要告诉它，1.需要返回什么类型的对象，2.需要返回的对象的数据结构和结果的映射，同时还可以对结果数据做缓存，提升性能
</span></span></code></pre></div><h4 id=25-重复sql>2.5 重复sql</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>1. 问题：sql语句很多都是where语句后面的部分不一样，重复语句，无意义，查询的字段有很多也是重复的(select aaa,bbb from)
</span></span><span style=display:flex><span>2. 解决：提取重复的sql片段
</span></span></code></pre></div><h2 id=3-jdbc演变为mybatis>3. JDBC演变为Mybatis</h2><p>mybatis是一个持久层框架，用java编写的。</p><p>它封装了jdbc操作的很多细节，使开发者只需要关注sql语句本身，而无需关注注册驱动，创建连接等繁杂过程</p><p>它使用了ORM思想实现了结果集的封装。</p><p>ORM：</p><p>Object Relational Mappging 对象关系映射</p><p>简单的说：</p><p>就是把数据库表和实体类及实体类的属性对应起来</p><p>让我们可以操作实体类就实现操作数据库表。</p><p><img src=/imgs/img-lazy-loading.gif data-src="img/image-20210418130511022.png#alt=image-20210418130511022" alt></p><h2 id=4-mybatis的使用>4. Mybatis的使用</h2><p>以下的方式不用特别记忆，了解即可，学习完Spring之后，spring+mybatis的方式才是主流</p><h4 id=41-定义dao接口>4.1 定义DAO接口</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.xiaopizhu.mybatis.dao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.pojo.User<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserDao</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    User <span style=color:#a6e22e>findUser</span><span style=color:#f92672>(</span>Long id<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=42-建立mybatis配置文件>4.2 建立Mybatis配置文件</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--数据源配置 --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;environments</span> <span style=color:#a6e22e>default=</span><span style=color:#e6db74>&#34;development&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;environment</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;development&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;transactionManager</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;jdbc&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>&lt;!--数据源 POOLED 利用“池”的概念将 JDBC 的 Connection 对象组织起来，它开始会有一些空置，并且已经连接好的数据库连接，所以请求时，无须再建立和验证，省去了创建新的连接实例时所必需的初始化和认证时间。它还控制最大连接数，避免过多的连接导致系统瓶颈。--&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;dataSource</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;POOLED&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;driver&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;com.mysql.cj.jdbc.Driver&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;url&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;jdbc:mysql://localhost:3306/god?serverTimezone=UTC&amp;amp;characterEncoding=utf-8&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;root&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;root&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/dataSource&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/environment&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/environments&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;mappers&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!--userMapper.xml装载进来 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;mapper</span> <span style=color:#a6e22e>resource=</span><span style=color:#e6db74>&#34;com/xiaopizhu/mybatis/dao/UserDao.xml&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/mappers&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span></code></pre></div><h4 id=43-创建xml和dao接口对应在其中统一写sql>4.3 创建xml和DAO接口对应，在其中统一写sql</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--MyBatis配置文件--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;mapper</span> <span style=color:#a6e22e>namespace=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.dao.UserDao&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>&lt;!--findUser和UserDao接口中的findUser方法对应--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUser&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;long&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select * from g_user where id = #{id}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/mapper&gt;</span>
</span></span></code></pre></div><h4 id=44-测试-并添加日志>4.4 测试 并添加日志</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.xiaopizhu.mybatis.service<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.dao.UserDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.pojo.User<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.io.Resources<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.SqlSession<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserService</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> User <span style=color:#a6e22e>findUser</span><span style=color:#f92672>(</span>Long id<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            User user <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>findUser</span><span style=color:#f92672>(</span>id<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.xiaopizhu.mybatis.service<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.dao.UserDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.dao.UserJDBCDao<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.xiaopizhu.mybatis.pojo.User<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.Before<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.Test<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserServiceTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserService userService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Before</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setup</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        userService <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UserService<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUser</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUser</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>添加日志:</p><p>log4j.properties</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>## debug 级别</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log4j.rootLogger</span><span style=color:#f92672>=</span><span style=color:#e6db74>DEBUG,Console</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log4j.appender.Console</span><span style=color:#f92672>=</span><span style=color:#e6db74>org.apache.log4j.ConsoleAppender  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log4j.appender.Console.Target</span><span style=color:#f92672>=</span><span style=color:#e6db74>System.out  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log4j.appender.Console.layout</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>org.apache.log4j.PatternLayout  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log4j.appender.Console.layout.ConversionPattern</span><span style=color:#f92672>=</span><span style=color:#e6db74>%d{yyyy-MM-dd-HH\:mm\:ss,SSS} [%t]  [%c] [%p] - %m%n  </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log4j.logger.com.mybatis</span><span style=color:#f92672>=</span><span style=color:#e6db74>DEBUG  /</span>
</span></span></code></pre></div><p>依赖:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>log4j<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>log4j<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>1.2.12<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>mybatis配置文件 添加:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span>  <span style=color:#f92672>&lt;settings&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;setting</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;logImpl&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;log4j&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/settings&gt;</span>
</span></span></code></pre></div><h4 id=45-insert-添加实现>4.5 insert 添加实现</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;insert</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;save&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span> <span style=color:#a6e22e>keyProperty=</span><span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#a6e22e>useGeneratedKeys=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        insert into g_user (username,age) values(#{username},#{age})
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/insert&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testSaveUser</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setUsername</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;wangwu&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setAge</span><span style=color:#f92672>(</span><span style=color:#ae81ff>25</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        userService<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>keyProperty=&ldquo;id&rdquo; useGeneratedKeys=&ldquo;true&rdquo; 代表将自增的id 辅助给User对象的id属性</p><h4 id=46-update-更新实现>4.6 update 更新实现</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;update</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;update&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        update g_user
</span></span><span style=display:flex><span>        set username=#{username},
</span></span><span style=display:flex><span>            age=#{age}
</span></span><span style=display:flex><span>        where id=#{id}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/update&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateUser</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> update <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;更新行数,&#34;</span><span style=color:#f92672>+</span>update<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testUpdateUser</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setUsername</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;wangwu333&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setAge</span><span style=color:#f92672>(</span><span style=color:#ae81ff>25</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setId</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5L</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        userService<span style=color:#f92672>.</span><span style=color:#a6e22e>updateUser</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=47-delete-删除实现>4.7 DELETE 删除实现</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>Long id<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;delete</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;delete&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;long&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        delete from g_user where id=#{id}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/delete&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>Long id<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> delete <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>id<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;删除行数,&#34;</span><span style=color:#f92672>+</span>delete<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testDelete</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        userService<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5L</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=48-列表查询实现>4.8 列表查询实现</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListGtAge</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> age<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserListGtAge&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select * from g_user where age &gt; #{age}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> age<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userListGtAge <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListGtAge</span><span style=color:#f92672>(</span>age<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userListGtAge<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserList</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserList</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>userList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=49-分页实现>4.9 分页实现</h4><h5 id=491-普通实现>4.9.1 普通实现</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>countUserListPage</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListPage</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Param</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;index&#34;</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>int</span> index<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                <span style=color:#a6e22e>@Param</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;size&#34;</span><span style=color:#f92672>)</span><span style=color:#66d9ef>int</span> size<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserListPage&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;map&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select *from g_user limit #{index},#{size}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;countUserListPage&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;java.lang.Long&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select count(1) from g_user
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListPage</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> page<span style=color:#f92672>,</span><span style=color:#66d9ef>int</span> size<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> index <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>page<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>)*</span>size<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListPage</span><span style=color:#f92672>(</span>index<span style=color:#f92672>,</span>size<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>long</span> total <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>countUserListPage</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;总数为:&#34;</span><span style=color:#f92672>+</span>total<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserListPage</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListPage</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span><span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>userList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=492-分页插件实现>4.9.2 分页插件实现</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>com.github.pagehelper<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>pagehelper<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>5.2.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugin</span> <span style=color:#a6e22e>interceptor=</span><span style=color:#e6db74>&#34;com.github.pagehelper.PageInterceptor&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    Page<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserList</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span>  <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserList&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select *from g_user
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserList</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> page<span style=color:#f92672>,</span><span style=color:#66d9ef>int</span> size<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            PageHelper<span style=color:#f92672>.</span><span style=color:#a6e22e>startPage</span><span style=color:#f92672>(</span>page<span style=color:#f92672>,</span>size<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            Page<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userListPage <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserList</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;总数为:&#34;</span><span style=color:#f92672>+</span>userListPage<span style=color:#f92672>.</span><span style=color:#a6e22e>getTotal</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> result <span style=color:#f92672>=</span> userListPage<span style=color:#f92672>.</span><span style=color:#a6e22e>getResult</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserListByPage</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserList</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span><span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>userList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=410-各种标签的使用>4.10 各种标签的使用</h4><h5 id=4101-where和if标签>4.10.1 where和if标签</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListByCondition</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> age<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- 注意看 where 后面的第一个and 通过日志打印的sql会发现and会消失，这就是where标签的作用--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserListByCondition&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;int&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select *from g_user
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;where&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;if</span> <span style=color:#a6e22e>test=</span><span style=color:#e6db74>&#34;age &gt; 0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>              and  age &gt; 0
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;if</span> <span style=color:#a6e22e>test=</span><span style=color:#e6db74>&#34;age &amp;lt; 15&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>               and age &amp;lt; 22
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/where&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListCondition</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> age<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListByCondition</span><span style=color:#f92672>(</span>age<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserListCondition</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListCondition</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>userList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=4102-foreach标签>4.10.2  foreach标签</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListByIds</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@Param</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;userIdList&#34;</span><span style=color:#f92672>)</span> List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> userIdList<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserListByIds&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;arraylist&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select *from g_user
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;where&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;if</span> <span style=color:#a6e22e>test=</span><span style=color:#e6db74>&#34;userIdList != null and userIdList.size &gt; 0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                id in
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;foreach</span> <span style=color:#a6e22e>collection=</span><span style=color:#e6db74>&#34;userIdList&#34;</span> <span style=color:#a6e22e>item=</span><span style=color:#e6db74>&#34;userId&#34;</span> <span style=color:#a6e22e>separator=</span><span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#a6e22e>open=</span><span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#a6e22e>close=</span><span style=color:#e6db74>&#34;)&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                    #{userId}
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;/foreach&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/where&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>findUserListByIds</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> userIdList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Mybatis-Config.xml&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            UserDao mapper <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> mapper<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListByIds</span><span style=color:#f92672>(</span>userIdList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> userList<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserListByIds</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> userIdList <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        userIdList<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        userIdList<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#ae81ff>2L</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserListByIds</span><span style=color:#f92672>(</span>userIdList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>userList<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=4103-set标签>4.10.3 set标签</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;update</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;update&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        update g_user
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;set&gt;</span>
</span></span><span style=display:flex><span>            username=#{username},
</span></span><span style=display:flex><span>            age=#{age},
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/set&gt;</span>
</span></span><span style=display:flex><span>        where id=#{id}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/update&gt;</span>
</span></span></code></pre></div><p>使用set标签，后面多一个逗号 也无所谓</p><h4 id=411-resultmap的使用>4.11 ResultMap的使用</h4><p>比如 g_user表中 多了一个字段 为id_card 身份证，这时候使用resultType=&ldquo;com.xiaopizhu.mybatis.pojo.User&rdquo; 是无法进行映射到User对象的idCard字段的。</p><p>这种场景下，就需要定义ResultMap 做对象和表字段的对应关系</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;resultMap</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;user&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;age&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;age&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;result</span> <span style=color:#a6e22e>column=</span><span style=color:#e6db74>&#34;id_card&#34;</span> <span style=color:#a6e22e>property=</span><span style=color:#e6db74>&#34;idCard&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserListByIds&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;arraylist&#34;</span> <span style=color:#a6e22e>resultMap=</span><span style=color:#e6db74>&#34;user&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select * from g_user
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;where&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;if</span> <span style=color:#a6e22e>test=</span><span style=color:#e6db74>&#34;userIdList != null and userIdList.size &gt; 0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                id in
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;foreach</span> <span style=color:#a6e22e>collection=</span><span style=color:#e6db74>&#34;userIdList&#34;</span> <span style=color:#a6e22e>item=</span><span style=color:#e6db74>&#34;userId&#34;</span> <span style=color:#a6e22e>separator=</span><span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#a6e22e>open=</span><span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#a6e22e>close=</span><span style=color:#e6db74>&#34;)&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                    #{userId}
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;/foreach&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/where&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><h4 id=412-事务>4.12 事务</h4><p>需求：之前实现的service方法 updateUser(User user)，在这个方法运行的过程当中 出现异常了，异常出现的位置在userDao.update(user) 之后，这时候，我们希望 对此数据进行回滚，已经更新的数据，回退回原来的数据</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>updateUser</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//1. 获取mybatis的配置文件 并加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Reader resourceAsReader <span style=color:#f92672>=</span> Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;MybatisConfig.xml&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//2. 构建sqlSession工厂
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            SqlSessionFactory build <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>resourceAsReader<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//3. 生产sqlSession true代表自动提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            sqlSession <span style=color:#f92672>=</span> build<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//4. 获取UserDao
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            UserDao userDao <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> update <span style=color:#f92672>=</span> userDao<span style=color:#f92672>.</span><span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//事务处理 抛异常了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>/</span><span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> update<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>如果运行以上的代码，发现 虽然报了异常，但是数据还是进行了更新，那么这时候我们该怎么办呢？</p><p>首先：</p><ol><li>自动提交不能使用回滚</li><li>已经提交的数据不能回滚</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>updateUser</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//1. 获取mybatis的配置文件 并加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Reader resourceAsReader <span style=color:#f92672>=</span> Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;MybatisConfig.xml&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//2. 构建sqlSession工厂
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            SqlSessionFactory build <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>resourceAsReader<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//3. 生产sqlSession true代表自动提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            sqlSession <span style=color:#f92672>=</span> build<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//4. 获取UserDao
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            UserDao userDao <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> update <span style=color:#f92672>=</span> userDao<span style=color:#f92672>.</span><span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//事务 抛异常了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>/</span><span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> update<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//回滚
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>rollback</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>一旦抛了异常，可以进行回滚使用sqlSession.rollback(); 数据就进行了回滚</p><h4 id=413-sql注入问题>4.13 sql注入问题</h4><p>在UserDao中写一个方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    User <span style=color:#a6e22e>findUserByName</span><span style=color:#f92672>(</span>String username<span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> User <span style=color:#a6e22e>findUserByName</span><span style=color:#f92672>(</span>String userName<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>        SqlSession sqlSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//1. 获取mybatis的配置文件 并加载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Reader resourceAsReader <span style=color:#f92672>=</span> Resources<span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsReader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;MybatisConfig.xml&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//2. 构建sqlSession工厂
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            SqlSessionFactory build <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBuilder<span style=color:#f92672>().</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span>resourceAsReader<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//3. 生产sqlSession
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            sqlSession <span style=color:#f92672>=</span> build<span style=color:#f92672>.</span><span style=color:#a6e22e>openSession</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//4. 获取UserDao
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            UserDao userDao <span style=color:#f92672>=</span> sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>UserDao<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            User user <span style=color:#f92672>=</span> userDao<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserByName</span><span style=color:#f92672>(</span>userName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>sqlSession <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                sqlSession<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserName</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> userService<span style=color:#f92672>.</span><span style=color:#a6e22e>findUserByName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#39;zhangsan&#39; or username=&#39;lisi&#39;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;findUserByName&#34;</span> <span style=color:#a6e22e>parameterType=</span><span style=color:#e6db74>&#34;string&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;com.xiaopizhu.mybatis.pojo.User&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        select * from g_user where username = ${username}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span></code></pre></div><h2 id=5-mybatis的原理>5. Mybatis的原理</h2><p><img src=/imgs/img-lazy-loading.gif data-src="img/image-20210418130511022.png#alt=image-20210418130511022" alt></p><p>Mybatis的功能架构分为三层：</p><ul><li>接口层：提供给外部使用的接口API，开发人员通过这些本地API来操作数据库。接口层接收到调用请求就会调用数据处理层来完成具体的数据处理。</li><li>数据处理层：负责具体的SQL查找、SQL解析、SQL执行和执行结果映射处理等。它主要的目的是根据调用的请求完成一次数据库操作。</li><li>框架支撑层：负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存处理，这些都是共用的东西，将他们抽取出来作为最基础的组件。为上层的数据处理层提供最基础的支撑。</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src="img/mybatis.png#alt=%E5%9B%BE%E7%89%87" alt></p><ul><li>SqlSession。作为MyBatis工作的主要顶层API，表示和数据库交互的会话，完成必要数据库增删改查功能。</li><li>Executor。MyBatis执行器，是MyBatis调度的核心，负责SQL语句的生成和查询缓存的维护。</li><li>StatementHandler。封装了JDBC Statement操作，负责对JDBCstatement的操作，如设置参数、将Statement结果集转换成List集合。</li><li>ParameterHandler。负责对用户传递的参数转换成JDBC Statement 所需要的参数。</li><li>ResultSetHandler。负责将JDBC返回的ResultSet结果集对象转换成List类型的集合。</li><li>TypeHandler 负责java数据类型和jdbc数据类型之间的映射和转换。</li><li>MappedStatement。MappedStatement维护了一条&lt;select|update|delete|insert>节点的封装。</li><li>SqlSource。负责根据用户传递的parameterObject，动态地生成SQL语句，将信息封装到BoundSql对象中，并返回。</li><li>BoundSql。表示动态生成的SQL语句以及相应的参数信息。</li><li>Configuration。MyBatis所有的配置信息都维持在Configuration对象之中。</li></ul><h5 id=51-typehandler>5.1 TypeHandler</h5><pre><code>无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时， 都会用类型处理器将获取的值以合适的方式转换成 Java 类型。
</code></pre><p><img src=/imgs/img-lazy-loading.gif data-src="img/640.webp#alt=%E5%9B%BE%E7%89%87" alt></p><p>以BigDecimalTypeHandler为例子:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2015 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.type<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.math.BigDecimal<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.CallableStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.PreparedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.ResultSet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BigDecimalTypeHandler</span> <span style=color:#66d9ef>extends</span> BaseTypeHandler<span style=color:#f92672>&lt;</span>BigDecimal<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setNonNullParameter</span><span style=color:#f92672>(</span>PreparedStatement ps<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> i<span style=color:#f92672>,</span> BigDecimal parameter<span style=color:#f92672>,</span> JdbcType jdbcType<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ps<span style=color:#f92672>.</span><span style=color:#a6e22e>setBigDecimal</span><span style=color:#f92672>(</span>i<span style=color:#f92672>,</span> parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> BigDecimal <span style=color:#a6e22e>getNullableResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> String columnName<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rs<span style=color:#f92672>.</span><span style=color:#a6e22e>getBigDecimal</span><span style=color:#f92672>(</span>columnName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> BigDecimal <span style=color:#a6e22e>getNullableResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rs<span style=color:#f92672>.</span><span style=color:#a6e22e>getBigDecimal</span><span style=color:#f92672>(</span>columnIndex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> BigDecimal <span style=color:#a6e22e>getNullableResult</span><span style=color:#f92672>(</span>CallableStatement cs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cs<span style=color:#f92672>.</span><span style=color:#a6e22e>getBigDecimal</span><span style=color:#f92672>(</span>columnIndex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>这个类的第一个方法是对预处理语句（PreparedStatement)设置参数，之后的三个函数都是从ResultSet或者用于执行存储过程的CallableStatement语句中获取BigDecimal类型的数值，用于向BigDecimal类型的Java字段赋值。</p><p>BigDecimalTypeHandler继承的BaseTypeHandler是个泛型类，其他的TypeHandler也是通过继承这个抽象类，实现其中的抽象方法，实现类型转换的工作。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2020 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.type<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.CallableStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.PreparedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.ResultSet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.executor.result.ResultMapException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.Configuration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * The base {@link TypeHandler} for references a generic type.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Important: Since 3.5.0, This class never call the {@link ResultSet#wasNull()} and
</span></span></span><span style=display:flex><span><span style=color:#75715e> * {@link CallableStatement#wasNull()} method for handling the SQL {@code NULL} value.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * In other words, {@code null} value handling should be performed on subclass.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Simone Tripodi
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Kzuki Shimizu
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseTypeHandler</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>extends</span> TypeReference<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>implements</span> TypeHandler<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @deprecated Since 3.5.0 - See https://github.com/mybatis/mybatis-3/issues/1203. This field will remove future.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Deprecated</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>protected</span> Configuration configuration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Sets the configuration.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param c
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          the new configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @deprecated Since 3.5.0 - See https://github.com/mybatis/mybatis-3/issues/1203. This property will remove future.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Deprecated</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setConfiguration</span><span style=color:#f92672>(</span>Configuration c<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>configuration</span> <span style=color:#f92672>=</span> c<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setParameter</span><span style=color:#f92672>(</span>PreparedStatement ps<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> i<span style=color:#f92672>,</span> T parameter<span style=color:#f92672>,</span> JdbcType jdbcType<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>parameter <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>jdbcType <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> TypeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;JDBC requires that the JdbcType must be specified for all nullable parameters.&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ps<span style=color:#f92672>.</span><span style=color:#a6e22e>setNull</span><span style=color:#f92672>(</span>i<span style=color:#f92672>,</span> jdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>TYPE_CODE</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>SQLException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> TypeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error setting null for parameter #&#34;</span> <span style=color:#f92672>+</span> i <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; with JdbcType &#34;</span> <span style=color:#f92672>+</span> jdbcType <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; . &#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;Try setting a different JdbcType for this parameter or a different jdbcTypeForNull configuration property. &#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        setNonNullParameter<span style=color:#f92672>(</span>ps<span style=color:#f92672>,</span> i<span style=color:#f92672>,</span> parameter<span style=color:#f92672>,</span> jdbcType<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> TypeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error setting non null for parameter #&#34;</span> <span style=color:#f92672>+</span> i <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; with JdbcType &#34;</span> <span style=color:#f92672>+</span> jdbcType <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; . &#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;Try setting a different JdbcType for this parameter or a different configuration property. &#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>getResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> String columnName<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> getNullableResult<span style=color:#f92672>(</span>rs<span style=color:#f92672>,</span> columnName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ResultMapException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error attempting to get column &#39;&#34;</span> <span style=color:#f92672>+</span> columnName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39; from result set.  Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>getResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> getNullableResult<span style=color:#f92672>(</span>rs<span style=color:#f92672>,</span> columnIndex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ResultMapException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error attempting to get column #&#34;</span> <span style=color:#f92672>+</span> columnIndex <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; from result set.  Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>getResult</span><span style=color:#f92672>(</span>CallableStatement cs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> getNullableResult<span style=color:#f92672>(</span>cs<span style=color:#f92672>,</span> columnIndex<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ResultMapException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error attempting to get column #&#34;</span> <span style=color:#f92672>+</span> columnIndex <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; from callable statement.  Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setNonNullParameter</span><span style=color:#f92672>(</span>PreparedStatement ps<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> i<span style=color:#f92672>,</span> T parameter<span style=color:#f92672>,</span> JdbcType jdbcType<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Gets the nullable result.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param rs
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          the rs
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param columnName
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          Colunm name, when configuration &lt;code&gt;useColumnLabel&lt;/code&gt; is &lt;code&gt;false&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return the nullable result
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @throws SQLException
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *           the SQL exception
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> T <span style=color:#a6e22e>getNullableResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> String columnName<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> T <span style=color:#a6e22e>getNullableResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> T <span style=color:#a6e22e>getNullableResult</span><span style=color:#f92672>(</span>CallableStatement cs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>这个抽象类实现了TypeHandler接口，这个接口主要定义了类型转换的几种操作。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2020 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.type<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.CallableStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.PreparedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.ResultSet<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>TypeHandler</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setParameter</span><span style=color:#f92672>(</span>PreparedStatement ps<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> i<span style=color:#f92672>,</span> T parameter<span style=color:#f92672>,</span> JdbcType jdbcType<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Gets the result.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param rs
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          the rs
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param columnName
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          Colunm name, when configuration &lt;code&gt;useColumnLabel&lt;/code&gt; is &lt;code&gt;false&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return the result
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @throws SQLException
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *           the SQL exception
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  T <span style=color:#a6e22e>getResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> String columnName<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  T <span style=color:#a6e22e>getResult</span><span style=color:#f92672>(</span>ResultSet rs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  T <span style=color:#a6e22e>getResult</span><span style=color:#f92672>(</span>CallableStatement cs<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> columnIndex<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>至于这个抽象类继承的TypeReference，主要是提供了获取这个T具体是哪个类型。在判断使用使用哪个TypeHandler时有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2016 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.type<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.ParameterizedType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.lang.reflect.Type<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * References a generic type.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param &lt;T&gt; the referenced type
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @since 3.1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Simone Tripodi
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TypeReference</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Type rawType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>TypeReference</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    rawType <span style=color:#f92672>=</span> getSuperclassTypeParameter<span style=color:#f92672>(</span>getClass<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Type <span style=color:#a6e22e>getSuperclassTypeParameter</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;</span> clazz<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Type genericSuperclass <span style=color:#f92672>=</span> clazz<span style=color:#f92672>.</span><span style=color:#a6e22e>getGenericSuperclass</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>genericSuperclass <span style=color:#66d9ef>instanceof</span> Class<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// try to climb up the hierarchy until meet something useful
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>TypeReference<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>!=</span> genericSuperclass<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> getSuperclassTypeParameter<span style=color:#f92672>(</span>clazz<span style=color:#f92672>.</span><span style=color:#a6e22e>getSuperclass</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> TypeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#39;&#34;</span> <span style=color:#f92672>+</span> getClass<span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39; extends TypeReference but misses the type parameter. &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;Remove the extension or add a type parameter to it.&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Type rawType <span style=color:#f92672>=</span> <span style=color:#f92672>((</span>ParameterizedType<span style=color:#f92672>)</span> genericSuperclass<span style=color:#f92672>).</span><span style=color:#a6e22e>getActualTypeArguments</span><span style=color:#f92672>()[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO remove this when Reflector is fixed to return Types
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>rawType <span style=color:#66d9ef>instanceof</span> ParameterizedType<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      rawType <span style=color:#f92672>=</span> <span style=color:#f92672>((</span>ParameterizedType<span style=color:#f92672>)</span> rawType<span style=color:#f92672>).</span><span style=color:#a6e22e>getRawType</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rawType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> Type <span style=color:#a6e22e>getRawType</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rawType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>toString</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rawType<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>首先Mybatis有一个默认的TypeHandler实现，这些TypeHandler是如何被Mybatis识别的呢？</p><p>答案是TypeHandlerRegistry。在Mybatis初始化配置的时候，TypeHandlerRegistry会把JdbcType和Java类型对应的映射关系注册进该类内部的Map中。</p><p>JDBC_TYPE_HANDLER_MAP中记录的是JdbcType和TypeHandler对应的关系。</p><p>TYPE_HANDLER_MAP中记录的是Java类型和对应的所有JdbcType以及其对应TypeHandler的映射关系关系。</p><p>UNKNOWN_TYPE_HANDLER是在执行BaseTypeHandler的抽象方法时，去先解析出来该用什么TypeHandler。</p><p>ALL_TYPE_HANDLERS_MAP中记录的是所有TypeHandler的Class和其实例之间的映射关系。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>JdbcType<span style=color:#f92672>,</span> TypeHandler<span style=color:#f92672>&lt;?&gt;&gt;</span>  jdbcTypeHandlerMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> EnumMap<span style=color:#f92672>&lt;&gt;(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>Type<span style=color:#f92672>,</span> Map<span style=color:#f92672>&lt;</span>JdbcType<span style=color:#f92672>,</span> TypeHandler<span style=color:#f92672>&lt;?&gt;&gt;&gt;</span> typeHandlerMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentHashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> TypeHandler<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> unknownTypeHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>Class<span style=color:#f92672>&lt;?&gt;,</span> TypeHandler<span style=color:#f92672>&lt;?&gt;&gt;</span> allTypeHandlersMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>TypeHandlerRegistry</span><span style=color:#f92672>(</span>Configuration configuration<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>unknownTypeHandler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UnknownTypeHandler<span style=color:#f92672>(</span>configuration<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Boolean<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BooleanTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BooleanTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>BOOLEAN</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BooleanTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>BIT</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BooleanTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Byte<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ByteTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ByteTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>TINYINT</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ByteTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Short<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ShortTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>short</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ShortTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>SMALLINT</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ShortTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> IntegerTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> IntegerTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>INTEGER</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> IntegerTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Long<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> LongTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>long</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> LongTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Float<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> FloatTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>float</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> FloatTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>FLOAT</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> FloatTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Double<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DoubleTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>double</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DoubleTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>DOUBLE</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DoubleTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Reader<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ClobReaderTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>CHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>CLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ClobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>VARCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>LONGVARCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NVARCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> NStringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> NStringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NCLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> NClobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>CHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>VARCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>CLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ClobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>LONGVARCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> StringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NVARCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> NStringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NCHAR</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> NStringTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NCLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> NClobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Object<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>ARRAY</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ArrayTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>ARRAY</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ArrayTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>BigInteger<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BigIntegerTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>BIGINT</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> LongTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>BigDecimal<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BigDecimalTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>REAL</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BigDecimalTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>DECIMAL</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BigDecimalTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>NUMERIC</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BigDecimalTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>InputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobInputStreamTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Byte<span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ByteObjectArrayTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Byte<span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>BLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobByteObjectArrayTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Byte<span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>LONGVARBINARY</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobByteObjectArrayTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ByteArrayTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>BLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>LONGVARBINARY</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>LONGVARBINARY</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>BLOB</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BlobTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Object<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> unknownTypeHandler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Object<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>OTHER</span><span style=color:#f92672>,</span> unknownTypeHandler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>OTHER</span><span style=color:#f92672>,</span> unknownTypeHandler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Date<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DateTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Date<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>DATE</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DateOnlyTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Date<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>TIME</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> TimeOnlyTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>TIMESTAMP</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DateTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>DATE</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> DateOnlyTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>TIME</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> TimeOnlyTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>sql</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Date</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SqlDateTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>sql</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Time</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SqlTimeTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>java<span style=color:#f92672>.</span><span style=color:#a6e22e>sql</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Timestamp</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SqlTimestampTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>String<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> JdbcType<span style=color:#f92672>.</span><span style=color:#a6e22e>SQLXML</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SqlxmlTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Instant<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> InstantTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>LocalDateTime<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> LocalDateTimeTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>LocalDate<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> LocalDateTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>LocalTime<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> LocalTimeTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>OffsetDateTime<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> OffsetDateTimeTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>OffsetTime<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> OffsetTimeTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>ZonedDateTime<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> ZonedDateTimeTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Month<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> MonthTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>Year<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> YearTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>YearMonth<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> YearMonthTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span>JapaneseDate<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> JapaneseDateTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// issue #273
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    register<span style=color:#f92672>(</span>Character<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> CharacterTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    register<span style=color:#f92672>(</span><span style=color:#66d9ef>char</span><span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> CharacterTypeHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>如果自定义一个TypeHandler 如何被Mybatis识别?</p><p>Mybatis在应用中启动时，会根据XML文件初始化配置，负责解析XML生成配置类的就是XMLConfigBuilder，通过调用其中的parseConfiguration方法填充配置类。</p><p>在Mybatis中配置了 标签 那么就会识别到。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>parseConfiguration</span><span style=color:#f92672>(</span>XNode root<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// issue #117 read properties first
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      propertiesElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;properties&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      Properties settings <span style=color:#f92672>=</span> settingsAsProperties<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;settings&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      loadCustomVfs<span style=color:#f92672>(</span>settings<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      loadCustomLogImpl<span style=color:#f92672>(</span>settings<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      typeAliasesElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;typeAliases&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      pluginElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;plugins&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      objectFactoryElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;objectFactory&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      objectWrapperFactoryElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;objectWrapperFactory&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      reflectorFactoryElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;reflectorFactory&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      settingsElement<span style=color:#f92672>(</span>settings<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// read it after objectFactory and objectWrapperFactory issue #631
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      environmentsElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;environments&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      databaseIdProviderElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;databaseIdProvider&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      typeHandlerElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;typeHandlers&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>      mapperElement<span style=color:#f92672>(</span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>evalNode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;mappers&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> BuilderException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Error parsing SQL Mapper Configuration. Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=52-resultsethandler>5.2 ResultSetHandler</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2019 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.executor.resultset<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.CallableStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.Statement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.cursor.Cursor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ResultSetHandler</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>handleResultSets</span><span style=color:#f92672>(</span>Statement stmt<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> Cursor<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>handleCursorResultSets</span><span style=color:#f92672>(</span>Statement stmt<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleOutputParameters</span><span style=color:#f92672>(</span>CallableStatement cs<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=53-parameterhandler>5.3 ParameterHandler</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2020 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.executor.parameter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.PreparedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * A parameter handler sets the parameters of the {@code PreparedStatement}.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ParameterHandler</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Object <span style=color:#a6e22e>getParameterObject</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setParameters</span><span style=color:#f92672>(</span>PreparedStatement ps<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2019 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.scripting.defaults<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.PreparedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.executor.ErrorContext<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.executor.parameter.ParameterHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.BoundSql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.MappedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.ParameterMapping<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.ParameterMode<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.reflection.MetaObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.Configuration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.type.JdbcType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.type.TypeException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.type.TypeHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.type.TypeHandlerRegistry<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Eduardo Macarron
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DefaultParameterHandler</span> <span style=color:#66d9ef>implements</span> ParameterHandler <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> TypeHandlerRegistry typeHandlerRegistry<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> MappedStatement mappedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> BoundSql boundSql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Configuration configuration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>DefaultParameterHandler</span><span style=color:#f92672>(</span>MappedStatement mappedStatement<span style=color:#f92672>,</span> Object parameterObject<span style=color:#f92672>,</span> BoundSql boundSql<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>mappedStatement</span> <span style=color:#f92672>=</span> mappedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>configuration</span> <span style=color:#f92672>=</span> mappedStatement<span style=color:#f92672>.</span><span style=color:#a6e22e>getConfiguration</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>typeHandlerRegistry</span> <span style=color:#f92672>=</span> mappedStatement<span style=color:#f92672>.</span><span style=color:#a6e22e>getConfiguration</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getTypeHandlerRegistry</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>parameterObject</span> <span style=color:#f92672>=</span> parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>boundSql</span> <span style=color:#f92672>=</span> boundSql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getParameterObject</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setParameters</span><span style=color:#f92672>(</span>PreparedStatement ps<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ErrorContext<span style=color:#f92672>.</span><span style=color:#a6e22e>instance</span><span style=color:#f92672>().</span><span style=color:#a6e22e>activity</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;setting parameters&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>object</span><span style=color:#f92672>(</span>mappedStatement<span style=color:#f92672>.</span><span style=color:#a6e22e>getParameterMap</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>ParameterMapping<span style=color:#f92672>&gt;</span> parameterMappings <span style=color:#f92672>=</span> boundSql<span style=color:#f92672>.</span><span style=color:#a6e22e>getParameterMappings</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>parameterMappings <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> parameterMappings<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ParameterMapping parameterMapping <span style=color:#f92672>=</span> parameterMappings<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>i<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>parameterMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>getMode</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> ParameterMode<span style=color:#f92672>.</span><span style=color:#a6e22e>OUT</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          Object value<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>          String propertyName <span style=color:#f92672>=</span> parameterMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>getProperty</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>boundSql<span style=color:#f92672>.</span><span style=color:#a6e22e>hasAdditionalParameter</span><span style=color:#f92672>(</span>propertyName<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// issue #448 ask first for additional params
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            value <span style=color:#f92672>=</span> boundSql<span style=color:#f92672>.</span><span style=color:#a6e22e>getAdditionalParameter</span><span style=color:#f92672>(</span>propertyName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>parameterObject <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>typeHandlerRegistry<span style=color:#f92672>.</span><span style=color:#a6e22e>hasTypeHandler</span><span style=color:#f92672>(</span>parameterObject<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>()))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            MetaObject metaObject <span style=color:#f92672>=</span> configuration<span style=color:#f92672>.</span><span style=color:#a6e22e>newMetaObject</span><span style=color:#f92672>(</span>parameterObject<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            value <span style=color:#f92672>=</span> metaObject<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>(</span>propertyName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>          TypeHandler typeHandler <span style=color:#f92672>=</span> parameterMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>getTypeHandler</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>          JdbcType jdbcType <span style=color:#f92672>=</span> parameterMapping<span style=color:#f92672>.</span><span style=color:#a6e22e>getJdbcType</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>value <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> jdbcType <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            jdbcType <span style=color:#f92672>=</span> configuration<span style=color:#f92672>.</span><span style=color:#a6e22e>getJdbcTypeForNull</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            typeHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>setParameter</span><span style=color:#f92672>(</span>ps<span style=color:#f92672>,</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> value<span style=color:#f92672>,</span> jdbcType<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>TypeException <span style=color:#f92672>|</span> SQLException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> TypeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Could not set parameters for mapping: &#34;</span> <span style=color:#f92672>+</span> parameterMapping <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;. Cause: &#34;</span> <span style=color:#f92672>+</span> e<span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=54-boundsql>5.4 BoundSql</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2019 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.mapping<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.HashMap<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Map<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.reflection.MetaObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.reflection.property.PropertyTokenizer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.Configuration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * An actual SQL String got from an {@link SqlSource} after having processed any dynamic content.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * The SQL may have SQL placeholders &#34;?&#34; and an list (ordered) of an parameter mappings
</span></span></span><span style=display:flex><span><span style=color:#75715e> * with the additional information for each parameter (at least the property name of the input object to read
</span></span></span><span style=display:flex><span><span style=color:#75715e> * the value from).
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Can also have additional parameters that are created by the dynamic language (for loops, bind...).
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BoundSql</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String sql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> List<span style=color:#f92672>&lt;</span>ParameterMapping<span style=color:#f92672>&gt;</span> parameterMappings<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> additionalParameters<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> MetaObject metaParameters<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>BoundSql</span><span style=color:#f92672>(</span>Configuration configuration<span style=color:#f92672>,</span> String sql<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;</span>ParameterMapping<span style=color:#f92672>&gt;</span> parameterMappings<span style=color:#f92672>,</span> Object parameterObject<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>sql</span> <span style=color:#f92672>=</span> sql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>parameterMappings</span> <span style=color:#f92672>=</span> parameterMappings<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>parameterObject</span> <span style=color:#f92672>=</span> parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>additionalParameters</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>metaParameters</span> <span style=color:#f92672>=</span> configuration<span style=color:#f92672>.</span><span style=color:#a6e22e>newMetaObject</span><span style=color:#f92672>(</span>additionalParameters<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getSql</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>ParameterMapping<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getParameterMappings</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> parameterMappings<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getParameterObject</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> parameterObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>hasAdditionalParameter</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    String paramName <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PropertyTokenizer<span style=color:#f92672>(</span>name<span style=color:#f92672>).</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> additionalParameters<span style=color:#f92672>.</span><span style=color:#a6e22e>containsKey</span><span style=color:#f92672>(</span>paramName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAdditionalParameter</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>,</span> Object value<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    metaParameters<span style=color:#f92672>.</span><span style=color:#a6e22e>setValue</span><span style=color:#f92672>(</span>name<span style=color:#f92672>,</span> value<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getAdditionalParameter</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> metaParameters<span style=color:#f92672>.</span><span style=color:#a6e22e>getValue</span><span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>打断点 启动调试 可以看出BoundSql 获取到的就是实际的sql语句，以及其中的参数等</p><h5 id=55-sqlsource>5.5 SqlSource</h5><p>就是构建BoundSql，根据用户传入的参数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2019 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.mapping<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Represents the content of a mapped statement read from an XML file or an annotation.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * It creates the SQL that will be passed to the database out of the input parameter received from the user.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SqlSource</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  BoundSql <span style=color:#a6e22e>getBoundSql</span><span style=color:#f92672>(</span>Object parameterObject<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=56-mappedstatement>5.6 MappedStatement</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Builder</span><span style=color:#f92672>(</span>Configuration configuration<span style=color:#f92672>,</span> String id<span style=color:#f92672>,</span> SqlSource sqlSource<span style=color:#f92672>,</span> SqlCommandType sqlCommandType<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span></code></pre></div><h5 id=57-statementhandler>5.7 StatementHandler</h5><p>就是对jdbc操作的一个实现</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2016 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.executor.statement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.Connection<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.Statement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.cursor.Cursor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.executor.parameter.ParameterHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.BoundSql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.ResultHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>StatementHandler</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Statement <span style=color:#a6e22e>prepare</span><span style=color:#f92672>(</span>Connection connection<span style=color:#f92672>,</span> Integer transactionTimeout<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>parameterize</span><span style=color:#f92672>(</span>Statement statement<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>batch</span><span style=color:#f92672>(</span>Statement statement<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>Statement statement<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>query</span><span style=color:#f92672>(</span>Statement statement<span style=color:#f92672>,</span> ResultHandler resultHandler<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> Cursor<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>queryCursor</span><span style=color:#f92672>(</span>Statement statement<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  BoundSql <span style=color:#a6e22e>getBoundSql</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ParameterHandler <span style=color:#a6e22e>getParameterHandler</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=58-executor>5.8 Executor</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2015 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.executor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.cache.CacheKey<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.cursor.Cursor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.BoundSql<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.mapping.MappedStatement<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.reflection.MetaObject<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.ResultHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.session.RowBounds<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.transaction.Transaction<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Executor</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ResultHandler NO_RESULT_HANDLER <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>query</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>,</span> ResultHandler resultHandler<span style=color:#f92672>,</span> CacheKey cacheKey<span style=color:#f92672>,</span> BoundSql boundSql<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>query</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>,</span> ResultHandler resultHandler<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> Cursor<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>queryCursor</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  List<span style=color:#f92672>&lt;</span>BatchResult<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>flushStatements</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>commit</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> required<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollback</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> required<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> SQLException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  CacheKey <span style=color:#a6e22e>createCacheKey</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> Object parameterObject<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>,</span> BoundSql boundSql<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isCached</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> CacheKey key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>clearLocalCache</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deferLoad</span><span style=color:#f92672>(</span>MappedStatement ms<span style=color:#f92672>,</span> MetaObject resultObject<span style=color:#f92672>,</span> String property<span style=color:#f92672>,</span> CacheKey key<span style=color:#f92672>,</span> Class<span style=color:#f92672>&lt;?&gt;</span> targetType<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Transaction <span style=color:#a6e22e>getTransaction</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> forceRollback<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isClosed</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setExecutorWrapper</span><span style=color:#f92672>(</span>Executor executor<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=59-sqlsession>5.9 SqlSession</h5><p>定义了对数据库操作的一系列行为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Copyright 2009-2020 the original author or authors.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    you may not use this file except in compliance with the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    You may obtain a copy of the License at
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    Unless required by applicable law or agreed to in writing, software
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    See the License for the specific language governing permissions and
</span></span></span><span style=display:flex><span><span style=color:#75715e> *    limitations under the License.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> org.apache.ibatis.session<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Closeable<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.sql.Connection<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Map<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.cursor.Cursor<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.ibatis.executor.BatchResult<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * The primary Java interface for working with MyBatis.
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Through this interface you can execute commands, get mappers and manage transactions.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Clinton Begin
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SqlSession</span> <span style=color:#66d9ef>extends</span> Closeable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a single row mapped from the statement key.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;T&gt; the returned object type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          the statement
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Mapped object
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a single row mapped from the statement key and parameter.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;T&gt; the returned object type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Mapped object
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a list of mapped objects from the statement key.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;E&gt; the returned list element type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return List of mapped object
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectList</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a list of mapped objects from the statement key and parameter.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;E&gt; the returned list element type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return List of mapped object
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectList</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a list of mapped objects from the statement key and parameter,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * within the specified row bounds.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;E&gt; the returned list element type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param rowBounds  Bounds to limit object retrieval
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return List of mapped object
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> List<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectList</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * The selectMap is a special case in that it is designed to convert a list
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * of results into a Map based on one of the properties in the resulting
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Eg. Return a of Map[Integer,Author] for selectMap(&#34;selectAuthors&#34;,&#34;id&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;K&gt; the returned Map keys type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;V&gt; the returned Map values type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param mapKey The property to use as key for each value in the list.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Map containing key pair data.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>K<span style=color:#f92672>,</span> V<span style=color:#f92672>&gt;</span> Map<span style=color:#f92672>&lt;</span>K<span style=color:#f92672>,</span> V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectMap</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> String mapKey<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * The selectMap is a special case in that it is designed to convert a list
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * of results into a Map based on one of the properties in the resulting
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;K&gt; the returned Map keys type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;V&gt; the returned Map values type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param mapKey The property to use as key for each value in the list.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Map containing key pair data.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>K<span style=color:#f92672>,</span> V<span style=color:#f92672>&gt;</span> Map<span style=color:#f92672>&lt;</span>K<span style=color:#f92672>,</span> V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectMap</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> String mapKey<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * The selectMap is a special case in that it is designed to convert a list
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * of results into a Map based on one of the properties in the resulting
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * objects.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;K&gt; the returned Map keys type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;V&gt; the returned Map values type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param mapKey The property to use as key for each value in the list.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param rowBounds  Bounds to limit object retrieval
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Map containing key pair data.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>K<span style=color:#f92672>,</span> V<span style=color:#f92672>&gt;</span> Map<span style=color:#f92672>&lt;</span>K<span style=color:#f92672>,</span> V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectMap</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> String mapKey<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * A Cursor offers the same results as a List, except it fetches data lazily using an Iterator.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;T&gt; the returned cursor element type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Cursor of mapped objects
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Cursor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectCursor</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * A Cursor offers the same results as a List, except it fetches data lazily using an Iterator.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;T&gt; the returned cursor element type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Cursor of mapped objects
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Cursor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectCursor</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * A Cursor offers the same results as a List, except it fetches data lazily using an Iterator.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;T&gt; the returned cursor element type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param rowBounds  Bounds to limit object retrieval
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Cursor of mapped objects
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Cursor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectCursor</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a single row mapped from the statement key and parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * using a {@code ResultHandler}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param handler ResultHandler that will handle each retrieved row
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> ResultHandler handler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a single row mapped from the statement
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * using a {@code ResultHandler}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param handler ResultHandler that will handle each retrieved row
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> ResultHandler handler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieve a single row mapped from the statement key and parameter using a {@code ResultHandler} and
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * {@code RowBounds}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          Unique identifier matching the statement to use.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          the parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param rowBounds
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          RowBound instance to limit the query results
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param handler
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *          ResultHandler that will handle each retrieved row
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>,</span> RowBounds rowBounds<span style=color:#f92672>,</span> ResultHandler handler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Execute an insert statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to execute.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return int The number of rows affected by the insert.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Execute an insert statement with the given parameter object. Any generated
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * autoincrement values or selectKey entries will modify the given parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * object properties. Only the number of rows affected will be returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to execute.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return int The number of rows affected by the insert.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Execute an update statement. The number of rows affected will be returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to execute.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return int The number of rows affected by the update.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Execute an update statement. The number of rows affected will be returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to execute.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return int The number of rows affected by the update.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Execute a delete statement. The number of rows affected will be returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to execute.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return int The number of rows affected by the delete.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Execute a delete statement. The number of rows affected will be returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param statement Unique identifier matching the statement to execute.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param parameter A parameter object to pass to the statement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return int The number of rows affected by the delete.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>String statement<span style=color:#f92672>,</span> Object parameter<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Flushes batch statements and commits database connection.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Note that database connection will not be committed if no updates/deletes/inserts were called.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * To force the commit call {@link SqlSession#commit(boolean)}
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>commit</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Flushes batch statements and commits database connection.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param force forces connection commit
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>commit</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> force<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Discards pending batch statements and rolls database connection back.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Note that database connection will not be rolled back if no updates/deletes/inserts were called.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * To force the rollback call {@link SqlSession#rollback(boolean)}
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollback</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Discards pending batch statements and rolls database connection back.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Note that database connection will not be rolled back if no updates/deletes/inserts were called.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param force forces connection rollback
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollback</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> force<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Flushes batch statements.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return BatchResult list of updated records
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @since 3.0.6
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  List<span style=color:#f92672>&lt;</span>BatchResult<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>flushStatements</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Closes the session.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Clears local session cache.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>clearCache</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieves current configuration.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  Configuration <span style=color:#a6e22e>getConfiguration</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieves a mapper.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param &lt;T&gt; the mapper type
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param type Mapper interface class
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return a mapper bound to this SqlSession
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>getMapper</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> type<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Retrieves inner database connection.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @return Connection
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  Connection <span style=color:#a6e22e>getConnection</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/mybatis>MyBatis</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="Colzry - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="Colzry - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
MyBatis教程</li><li class=post-copyright-author><strong>本文作者：</strong>
Colzry</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://colzry.github.io/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatis%E6%95%99%E7%A8%8B/ title=MyBatis教程>https://colzry.github.io/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatis%E6%95%99%E7%A8%8B/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/mybatisplus-%E5%88%86%E9%A1%B5/ rel=next title=MyBatisPlus分页><i class="fa fa-chevron-left"></i> MyBatisPlus分页</a></div><div class="post-nav-prev post-nav-item"><a href=/posts/java/mybatis%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/ rel=prev title=MyBatis使用示例>MyBatis使用示例
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Colzry</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.113.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.1 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel></a>
<a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云></a>
<a target=_blank href=https://webify.cloudbase.net title=Webify>Webify</a>
<span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://colzry.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.37028fbafbd97fd89808b4c7b5a3a81f01ed0ab24001d273d774f9546a0e9170.js defer></script></body></html>