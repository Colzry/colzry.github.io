<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.116.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.png><link rel=icon type=image/x-icon href=/imgs/icons/favicon.png><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/favicon.png><meta itemprop=name content="SpringSecurity入门"><meta itemprop=description content="SpringSecurity入门"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blog.colzry.tk/imgs/avatar.jpg"><meta itemprop=keywords content="SpringSecurity"><meta property="og:type" content="article"><meta property="og:title" content="SpringSecurity入门"><meta property="og:description" content="SpringSecurity入门"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blog.colzry.tk/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/springsecurity/"><meta property="og:site_name" content="Colzry's Blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Colzry"><meta property="article:published_time" content="2023-06-16 16:41:30 +0800 +0800"><meta property="article:modified_time" content="2023-06-16 16:41:30 +0800 +0800"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.7efab351038eac56da41c92d9d6d38d8a9f1fc8fd6a9b17ea5982415a7b542a3.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"springsecurity","permalink":"https://blog.colzry.tk/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/springsecurity/","title":"SpringSecurity入门","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>SpringSecurity入门 - Colzry's Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Colzry's Blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Colzry的博客</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>112</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#1-快速入门>1. 快速入门</a><ul><li><a href=#11-创建工程>1.1 创建工程</a><ul><li><a href=#111-先创建父工程>1.1.1 先创建父工程</a></li><li><a href=#112-将不需要的文件都删除>1.1.2 将不需要的文件都删除</a></li><li><a href=#113-在该工程中新建module>1.1.3 在该工程中新建Module</a></li><li><a href=#114-引入依赖>1.1.4 引入依赖</a></li><li><a href=#115-初始化子模块项目>1.1.5 初始化子模块项目</a></li></ul></li><li><a href=#12-测试springsecurity>1.2 测试SpringSecurity</a></li></ul></li><li><a href=#2-认证>2. 认证</a><ul><li><a href=#21-登录校验流程>2.1 登录校验流程</a></li><li><a href=#22-springsecurity流程>2.2 SpringSecurity流程</a></li><li><a href=#23-认证流程>2.3 认证流程</a></li><li><a href=#24-编写认证代码>2.4 编写认证代码</a><ul><li><a href=#241-思路分析>2.4.1 思路分析</a></li><li><a href=#242-准备工作>2.4.2 准备工作</a></li><li><a href=#243-实现>2.4.3 实现</a></li></ul></li></ul></li><li><a href=#3-授权>3. 授权</a><ul><li><a href=#31-rbac权限模型>3.1 RBAC权限模型</a></li><li><a href=#32-授权实现>3.2 授权实现</a><ul><li><a href=#321-限制访问资源的权限>3.2.1 限制访问资源的权限</a></li><li><a href=#322-封装权限信息>3.2.2 封装权限信息</a></li></ul></li><li><a href=#33-封装从数据库中查询的权限信息>3.3 封装从数据库中查询的权限信息</a><ul><li><a href=#331-mysql数据表>3.3.1 MySql数据表</a></li><li><a href=#332-代码实现>3.3.2 代码实现</a></li><li><a href=#333-权限测试>3.3.3 权限测试</a></li></ul></li><li><a href=#34-自定义失败处理>3.4 自定义失败处理</a><ul><li><a href=#341-自定义实现类>3.4.1 自定义实现类</a></li><li><a href=#342-配置给springsecurity>3.4.2 配置给SpringSecurity</a></li></ul></li><li><a href=#35-其他处理器>3.5 其他处理器</a><ul><li><a href=#351-认证成功和认证失败处理器>3.5.1 认证成功和认证失败处理器</a></li><li><a href=#352-注销成功处理器>3.5.2 注销成功处理器</a></li></ul></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Colzry src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Colzry</p><div class=site-description itemprop=description>今早起来雾沉沉，我是一个抽卡人</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>112</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>18</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>57</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/Colzry title="Github → https://github.com/Colzry" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=mailto:colzry@foxmail.com title="E-Mail → mailto:colzry@foxmail.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2021-04-16T16:41:30+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=114635></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=296></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-06-16T16:41:30+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/Colzry rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blog.colzry.tk/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/springsecurity/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Colzry"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Colzry"><meta itemprop=description content="今早起来雾沉沉，我是一个抽卡人"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="SpringSecurity入门"><meta itemprop=description content="SpringSecurity入门"></span><header class=post-header><h1 class=post-title itemprop="name headline">SpringSecurity入门</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2023-06-16 16:41:30 +0800 +0800" itemprop="dateCreated datePublished" datetime="2023-06-16 16:41:30 +0800 +0800">2023-06-16</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6 itemprop=url rel=index><span itemprop=name>框架和中间件</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>9170</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>19分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/springsecurity/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=1-快速入门>1. 快速入门</h2><h3 id=11-创建工程>1.1 创建工程</h3><h4 id=111-先创建父工程>1.1.1 先创建父工程</h4><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660307652271-e1bdf679-a499-4bbb-9482-7f775003cd25.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=711&amp;id=ue18b5275&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1066&amp;originWidth=1182&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=85339&amp;status=done&amp;style=none&amp;taskId=ud1ec75d4-d880-471c-9705-2e0f768972a&amp;title=&amp;width=788" alt=image.png>
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660307770533-e12aa610-1440-4576-82f7-9edff163e9d7.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=711&amp;id=uf4172c51&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1066&amp;originWidth=1182&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=73589&amp;status=done&amp;style=none&amp;taskId=ua95d868f-c4df-4617-82d7-17ab2989ae9&amp;title=&amp;width=788" alt=image.png></p><h4 id=112-将不需要的文件都删除>1.1.2 将不需要的文件都删除</h4><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660307911544-530d8557-d0e9-45f8-8cc8-79dbd3065604.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=329&amp;id=u0b46a25e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=494&amp;originWidth=544&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33566&amp;status=done&amp;style=none&amp;taskId=u11cce0f1-068b-4cb5-9442-3383ad84fff&amp;title=&amp;width=362.6666666666667" alt=image.png><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660307924879-1a2de041-879d-49fd-a9d5-39364f09f5aa.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=248&amp;id=uaadd45dd&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=372&amp;originWidth=552&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25918&amp;status=done&amp;style=none&amp;taskId=u2028216a-57d4-4a4a-a144-217fd8747db&amp;title=&amp;width=368" alt=image.png></p><h4 id=113-在该工程中新建module>1.1.3 在该工程中新建Module</h4><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660308025221-c74a2f13-facb-4a37-b312-044e2ecbf969.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=218&amp;id=u44163132&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=327&amp;originWidth=843&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39090&amp;status=done&amp;style=none&amp;taskId=u2a904923-7b99-46a6-8cd1-c0c69ecb7dd&amp;title=&amp;width=562" alt=image.png>
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660308099657-09cacb0b-32cb-48cd-a793-b242f21ee0fd.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=610&amp;id=u8479b6a3&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=915&amp;originWidth=1182&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=77731&amp;status=done&amp;style=none&amp;taskId=u8c340d6a-4978-485b-a128-9bd0ead71b0&amp;title=&amp;width=788" alt=image.png></p><h4 id=114-引入依赖>1.1.4 引入依赖</h4><p><strong>父模块依赖</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;project</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;modelVersion&gt;</span>4.0.0<span style=color:#f92672>&lt;/modelVersion&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;parent&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-parent<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;version&gt;</span>2.3.7.RELEASE<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;relativePath/&gt;</span> <span style=color:#75715e>&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/parent&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.colzry<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>SpringBootDemo<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>0.0.1-SNAPSHOT<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;packaging&gt;</span>pom<span style=color:#f92672>&lt;/packaging&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;modules&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;module&gt;</span>SecurityJWT<span style=color:#f92672>&lt;/module&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;module&gt;</span>AOPDemo<span style=color:#f92672>&lt;/module&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/modules&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maven.compiler.source&gt;</span>8<span style=color:#f92672>&lt;/maven.compiler.source&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maven.compiler.target&gt;</span>8<span style=color:#f92672>&lt;/maven.compiler.target&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;java.version&gt;</span>1.8<span style=color:#f92672>&lt;/java.version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 注意：以下引入的依赖在子模块中不必再次引入 --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入Spring MVC --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入热部署依赖 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-devtools<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>runtime<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;optional&gt;</span>true<span style=color:#f92672>&lt;/optional&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入配置文件提示依赖 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-configuration-processor<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;optional&gt;</span>true<span style=color:#f92672>&lt;/optional&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入lombok --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;optional&gt;</span>true<span style=color:#f92672>&lt;/optional&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入Springboot JunitTest 测试 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/project&gt;</span>
</span></span></code></pre></div><p><strong>子模块依赖</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;project</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;modelVersion&gt;</span>4.0.0<span style=color:#f92672>&lt;/modelVersion&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;parent&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>SpringBootDemo<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>com.colzry<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;version&gt;</span>0.0.1-SNAPSHOT<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/parent&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>SecurityJWT<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入 SpringSecurity--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-security<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入mybatis-plus --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>com.baomidou<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>3.4.2<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入mysql连接驱动 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>mysql<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>mysql-connector-java<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>runtime<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入druid连接池 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>druid-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>1.2.11<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入redis --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入 apache lang3 工具包 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.commons<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>commons-lang3<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>3.12.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入JWT token 验证 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>io.jsonwebtoken<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>jjwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>0.9.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入阿里 fastJson --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.fastjson2<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>fastjson2<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>2.0.11<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- 引入阿里 fastJson 扩展 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.fastjson2<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>fastjson2-extension<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>2.0.11<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;mainClass&gt;</span>com.securityJWT.SecurityJWTApplication<span style=color:#f92672>&lt;/mainClass&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;layout&gt;</span>JAR<span style=color:#f92672>&lt;/layout&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/build&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/project&gt;</span>
</span></span></code></pre></div><h4 id=115-初始化子模块项目>1.1.5 初始化子模块项目</h4><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660308711681-1046829d-b07d-42df-b65d-b65b6cf7bccd.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=324&amp;id=ubd756a9d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=486&amp;originWidth=429&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24707&amp;status=done&amp;style=none&amp;taskId=u8d748151-2f17-4eb9-bebd-dc92f762450&amp;title=&amp;width=286" alt=image.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityJWTApplication</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SpringApplication<span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>(</span>SecurityJWTApplication<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> args<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8010</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>datasource</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver-class-name</span>: <span style=color:#ae81ff>com.mysql.cj.jdbc.Driver</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 使用druid数据源</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>com.alibaba.druid.pool.DruidDataSource</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>jdbc:mysql://43.142.174.216:5206/demo?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>username</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>host</span>: <span style=color:#ae81ff>43.142.174.216</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5079</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#ae81ff>czyadmin</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>mybatis-plus</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>configuration</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># 是否开启自动驼峰命名规则映射:从数据库列名到Java属性驼峰命名的类似映射</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>map-underscore-to-camel-case</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 如果查询结果中包含空值的列，则 MyBatis 在映射的时候，不会映射这个字段</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>call-setters-on-nulls</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Mybatis-Plus SQL 日志打印</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>log-impl</span>: <span style=color:#ae81ff>org.apache.ibatis.logging.stdout.StdOutImpl</span>
</span></span></code></pre></div><h3 id=12-测试springsecurity>1.2 测试SpringSecurity</h3><p>新建一个Controller来测试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/hello&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestController</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;{name}&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getHello</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@PathVariable</span> String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>启动后密码会初始化
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660309134479-8d6d8177-a534-4fdd-a9a0-710210ff1a31.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=345&amp;id=u330960ef&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=517&amp;originWidth=1638&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=132086&amp;status=done&amp;style=none&amp;taskId=u3f22d911-f5ba-451d-b818-7e537d362bd&amp;title=&amp;width=1092" alt=image.png>
访问**/hello/Clozry<strong>会被拦截
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660309279846-1ed55b04-88c8-449c-ab4d-38a166848063.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=345&amp;id=u69362e94&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=518&amp;originWidth=1374&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=34332&amp;status=done&amp;style=none&amp;taskId=u153e7813-dd9c-4e45-bca2-07bed31c7ca&amp;title=&amp;width=916" alt=image.png>
输入用户名</strong>user<strong>和</strong>控制台打印的密码**后可以正常访问
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660309442326-428c52b1-541d-4e71-baac-40415cd8d6f7.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=117&amp;id=u112f0eef&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=175&amp;originWidth=502&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=15586&amp;status=done&amp;style=none&amp;taskId=u310ab099-1f5e-4bbc-b125-ca09ec5dda8&amp;title=&amp;width=334.6666666666667" alt=image.png></p><h2 id=2-认证>2. 认证</h2><h3 id=21-登录校验流程>2.1 登录校验流程</h3><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660311785651-9beb0cf7-a1e4-4353-8e93-75fe76c1ad7a.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=685&amp;id=u9a6c9749&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1028&amp;originWidth=1091&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1770248&amp;status=done&amp;style=none&amp;taskId=u0032c163-28c8-403a-b45b-e187f2d05f6&amp;title=&amp;width=727.3333333333334" alt=image.png></p><h3 id=22-springsecurity流程>2.2 SpringSecurity流程</h3><p>SpringSecurity的原理其实就是一个过滤器链，内部包含了提供各种功能的过滤器。这里我们可以看看入门案例中的过滤器。
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660310326325-aecf2805-b522-4e89-ae18-a64b6fcddcaf.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=289&amp;id=ua4ae8187&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=434&amp;originWidth=1191&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=406510&amp;status=done&amp;style=none&amp;taskId=u96d931b3-99f9-45ab-ad04-ba1eae118c6&amp;title=&amp;width=794" alt=image.png>
图中只展示了核心过滤器，其它的非核心过滤器并没有在图中展示。</p><ul><li>UsernamePasswordAuthenticationFilter:负责处理我们在登陆页面填写了用户名密码后的登陆请求。入门案例的认证工作主要有它负责。</li><li>ExceptionTranslationFilter：处理过滤器链中抛出的任何AccessDeniedException和AuthenticationException。</li><li>FilterSecurityInterceptor：负责权限校验的过滤器。</li></ul><h3 id=23-认证流程>2.3 认证流程</h3><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660316114060-49e728f1-b864-4e77-bf5d-7800e5a8a8f5.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=515&amp;id=ud4b2a3e8&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=773&amp;originWidth=1802&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=369068&amp;status=done&amp;style=none&amp;taskId=ufbb7acbd-b2c9-408f-9881-af59ca06b30&amp;title=&amp;width=1201.3333333333333" alt=image.png></p><ul><li>Authentication接口: 它的实现类，表示当前访问系统的用户，封装了用户相关信息。</li><li>AuthenticationManager接口：定义了认证Authentication的方法</li><li>UserDetailsService接口：加载用户特定数据的核心接口。里面定义了一个根据用户名查询用户信息的方法。</li><li>UserDetails接口：提供核心用户信息。通过UserDetailsService根据用户名获取处理的用户信息要封装成UserDetails对象返回。然后将这些信息封装到Authentication对象中。</li></ul><h3 id=24-编写认证代码>2.4 编写认证代码</h3><h4 id=241-思路分析>2.4.1 思路分析</h4><p>登录
①自定义登录接口
调用ProviderManager的方法进行认证 如果认证通过生成jwt
把用户信息存入redis中
②自定义UserDetailsService
在这个实现类中去查询数据库
校验：
①定义Jwt认证过滤器
获取token
解析token获取其中的userid
从redis中获取用户信息
存入SecurityContextHolder</p><h4 id=242-准备工作>2.4.2 准备工作</h4><ol><li>引入_1.1.4_中的依赖</li><li>添加Redis配置和RedisUtils(简化版)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableCaching</span> <span style=color:#75715e>// spring版本3.1起自动缓存 由CacheManager Bean配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedisConfig</span> <span style=color:#66d9ef>extends</span> CachingConfigurerSupport <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SuppressWarnings</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;unchecked&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;rawtypes&#34;</span><span style=color:#f92672>})</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> RedisTemplate<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>redisTemplate</span><span style=color:#f92672>(</span>RedisConnectionFactory connectionFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        RedisTemplate<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RedisTemplate<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>setConnectionFactory</span><span style=color:#f92672>(</span>connectionFactory<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 需要添加 fastjson2-extension 依赖, 使用fastJson2来序列化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        GenericFastJsonRedisSerializer serializer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GenericFastJsonRedisSerializer<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>setDefaultSerializer</span><span style=color:#f92672>(</span>serializer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>setValueSerializer</span><span style=color:#f92672>(</span>serializer<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 使用StringRedisSerializer来序列化和反序列化redis的key值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>setKeySerializer</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> StringRedisSerializer<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>setHashKeySerializer</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> StringRedisSerializer<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>setHashValueSerializer</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> StringRedisSerializer<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        template<span style=color:#f92672>.</span><span style=color:#a6e22e>afterPropertiesSet</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> template<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CacheManager <span style=color:#a6e22e>cacheManager</span><span style=color:#f92672>(</span>RedisConnectionFactory connectionFactory<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 缓存30分钟
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Duration duration <span style=color:#f92672>=</span> Duration<span style=color:#f92672>.</span><span style=color:#a6e22e>ofSeconds</span><span style=color:#f92672>(</span>30<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        RedisCacheConfiguration redisCacheConfiguration <span style=color:#f92672>=</span> RedisCacheConfiguration<span style=color:#f92672>.</span><span style=color:#a6e22e>defaultCacheConfig</span><span style=color:#f92672>().</span><span style=color:#a6e22e>entryTtl</span><span style=color:#f92672>(</span>duration<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> RedisCacheManager<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>(</span>RedisCacheWriter<span style=color:#f92672>.</span><span style=color:#a6e22e>nonLockingRedisCacheWriter</span><span style=color:#f92672>(</span>connectionFactory<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>cacheDefaults</span><span style=color:#f92672>(</span>redisCacheConfiguration<span style=color:#f92672>).</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RedisUtil</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RedisTemplate<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> redisTemplate<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 判断 key 是否存在
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 如果存在 key 则返回 true，否则返回 false
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Boolean <span style=color:#a6e22e>exists</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>hasKey</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 获取 Key 的类型
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>type</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        DataType dataType <span style=color:#f92672>=</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>type</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> dataType <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> dataType<span style=color:#f92672>.</span><span style=color:#a6e22e>code</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 指定缓存失效时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key  键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param time 时间(秒)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 30
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>expire</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> time<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>time <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>expire</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> time<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 根据key 获取过期时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 键 不能为null
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 时间(秒) 返回0代表为永久有效
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>getExpire</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>getExpire</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 判断key是否存在
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return true 存在 false不存在
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>hasKey</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>hasKey</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 删除 key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Long <span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>String<span style=color:#f92672>...</span> key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>key <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> key<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> 1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> 0L<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>asList</span><span style=color:#f92672>(</span>key<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 获取所有的keys
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Set<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>keys</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> keys1 <span style=color:#f92672>=</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>keys</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;*&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> keys1<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 获取所有的keys得所有的值
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param keys
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> HashMap<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getKeysValue</span><span style=color:#f92672>(</span>String keys<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Set<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> keys1 <span style=color:#f92672>=</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>keys</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;*&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        HashMap<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> hashMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>Object s <span style=color:#f92672>:</span> keys1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Object o <span style=color:#f92672>=</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>opsForValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>keys <span style=color:#f92672>+</span> s<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;o=&#34;</span> <span style=color:#f92672>+</span> o<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            hashMap<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>keys1<span style=color:#f92672>,</span> o<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> hashMap<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 删除缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 可以传一个值 或多个
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>del</span><span style=color:#f92672>(</span>String<span style=color:#f92672>...</span> key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>key <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> key<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>key<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> 1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>key<span style=color:#f92672>[</span>0<span style=color:#f92672>]);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>delete</span><span style=color:#f92672>(</span>CollectionUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>arrayToList</span><span style=color:#f92672>(</span>key<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ============================String=============================
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 普通缓存获取
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key 键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 值
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> key <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>:</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>opsForValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 普通缓存放入
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key   键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param value 值
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return true成功 false失败
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>set</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>,</span> Object value<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>opsForValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> value<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 普通缓存放入并设置时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key   键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param value 值
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param time  时间(秒) time要大于0 如果time小于等于0 将设置无限期
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return true成功 false 失败
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>set</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>,</span> Object value<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> time<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>time <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>opsForValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> value<span style=color:#f92672>,</span> time<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>SECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                set<span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> value<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 递增
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key   键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param delta 要增加几(大于0)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>incr</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> delta<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>delta <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;递增因子必须大于0&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>opsForValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>increment</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> delta<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 递减
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param key   键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param delta 要减少几(小于0)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>decr</span><span style=color:#f92672>(</span>String key<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> delta<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>delta <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;递减因子必须大于0&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redisTemplate<span style=color:#f92672>.</span><span style=color:#a6e22e>opsForValue</span><span style=color:#f92672>().</span><span style=color:#a6e22e>increment</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> <span style=color:#f92672>-</span>delta<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=3><li>添加响应类Result</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Result</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> success<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> code<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String msg<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Object data<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Result</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> success<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> code<span style=color:#f92672>,</span> String msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>success</span> <span style=color:#f92672>=</span> success<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> code<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>msg</span> <span style=color:#f92672>=</span> msg<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Result <span style=color:#a6e22e>success</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> 200<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;success&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Result <span style=color:#a6e22e>success</span><span style=color:#f92672>(</span>Object data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> 200<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;success&#34;</span><span style=color:#f92672>,</span> data<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Result <span style=color:#a6e22e>fail</span><span style=color:#f92672>(</span>String msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> 500<span style=color:#f92672>,</span> msg<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Result <span style=color:#a6e22e>fail</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> code<span style=color:#f92672>,</span> String msg<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> code<span style=color:#f92672>,</span> msg<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=4><li>Jwt工具类</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtUtil</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//有效期为
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Long JWT_TTL <span style=color:#f92672>=</span> 60 <span style=color:#f92672>*</span> 60 <span style=color:#f92672>*</span> 1000L<span style=color:#f92672>;</span><span style=color:#75715e>// 60 * 60 * 1000  一个小时
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//设置秘钥明文
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String JWT_KEY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;colzry&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getUUID</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        String token <span style=color:#f92672>=</span> UUID<span style=color:#f92672>.</span><span style=color:#a6e22e>randomUUID</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>().</span><span style=color:#a6e22e>replaceAll</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;-&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> token<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成jtw
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param subject token中要存放的数据（json格式）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>createJWT</span><span style=color:#f92672>(</span>String subject<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        JwtBuilder builder <span style=color:#f92672>=</span> getJwtBuilder<span style=color:#f92672>(</span>subject<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> getUUID<span style=color:#f92672>());</span><span style=color:#75715e>// 设置过期时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> builder<span style=color:#f92672>.</span><span style=color:#a6e22e>compact</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成jtw
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param subject token中要存放的数据（json格式）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param ttlMillis token超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>createJWT</span><span style=color:#f92672>(</span>String subject<span style=color:#f92672>,</span> Long ttlMillis<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        JwtBuilder builder <span style=color:#f92672>=</span> getJwtBuilder<span style=color:#f92672>(</span>subject<span style=color:#f92672>,</span> ttlMillis<span style=color:#f92672>,</span> getUUID<span style=color:#f92672>());</span><span style=color:#75715e>// 设置过期时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> builder<span style=color:#f92672>.</span><span style=color:#a6e22e>compact</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> JwtBuilder <span style=color:#a6e22e>getJwtBuilder</span><span style=color:#f92672>(</span>String subject<span style=color:#f92672>,</span> Long ttlMillis<span style=color:#f92672>,</span> String uuid<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SignatureAlgorithm signatureAlgorithm <span style=color:#f92672>=</span> SignatureAlgorithm<span style=color:#f92672>.</span><span style=color:#a6e22e>HS256</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        SecretKey secretKey <span style=color:#f92672>=</span> generalKey<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> nowMillis <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>currentTimeMillis</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Date now <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date<span style=color:#f92672>(</span>nowMillis<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>ttlMillis<span style=color:#f92672>==</span><span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>            ttlMillis<span style=color:#f92672>=</span>JwtUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>JWT_TTL</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> expMillis <span style=color:#f92672>=</span> nowMillis <span style=color:#f92672>+</span> ttlMillis<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Date expDate <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date<span style=color:#f92672>(</span>expMillis<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Jwts<span style=color:#f92672>.</span><span style=color:#a6e22e>builder</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setId</span><span style=color:#f92672>(</span>uuid<span style=color:#f92672>)</span>              <span style=color:#75715e>//唯一的ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setSubject</span><span style=color:#f92672>(</span>subject<span style=color:#f92672>)</span>   <span style=color:#75715e>// 主题  可以是JSON数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setIssuer</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;colzry&#34;</span><span style=color:#f92672>)</span>     <span style=color:#75715e>// 签发者
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setIssuedAt</span><span style=color:#f92672>(</span>now<span style=color:#f92672>)</span>      <span style=color:#75715e>// 签发时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>signWith</span><span style=color:#f92672>(</span>signatureAlgorithm<span style=color:#f92672>,</span> secretKey<span style=color:#f92672>)</span> <span style=color:#75715e>//使用HS256对称加密算法签名, 第二个参数为秘钥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setExpiration</span><span style=color:#f92672>(</span>expDate<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 创建token
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param subject
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param ttlMillis
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>createJWT</span><span style=color:#f92672>(</span>String id<span style=color:#f92672>,</span> String subject<span style=color:#f92672>,</span> Long ttlMillis<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        JwtBuilder builder <span style=color:#f92672>=</span> getJwtBuilder<span style=color:#f92672>(</span>subject<span style=color:#f92672>,</span> ttlMillis<span style=color:#f92672>,</span> id<span style=color:#f92672>);</span><span style=color:#75715e>// 设置过期时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> builder<span style=color:#f92672>.</span><span style=color:#a6e22e>compact</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 生成加密后的秘钥 secretKey
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> SecretKey <span style=color:#a6e22e>generalKey</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> encodedKey <span style=color:#f92672>=</span> Base64<span style=color:#f92672>.</span><span style=color:#a6e22e>getDecoder</span><span style=color:#f92672>().</span><span style=color:#a6e22e>decode</span><span style=color:#f92672>(</span>JwtUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>JWT_KEY</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        SecretKey key <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SecretKeySpec<span style=color:#f92672>(</span>encodedKey<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> encodedKey<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;AES&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> key<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 解析
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param jwt
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws Exception
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Claims <span style=color:#a6e22e>parseJWT</span><span style=color:#f92672>(</span>String jwt<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SecretKey secretKey <span style=color:#f92672>=</span> generalKey<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Jwts<span style=color:#f92672>.</span><span style=color:#a6e22e>parser</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>setSigningKey</span><span style=color:#f92672>(</span>secretKey<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>parseClaimsJws</span><span style=color:#f92672>(</span>jwt<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>getBody</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String token <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjYWM2ZDVhZi1mNjVlLTQ0MDAtYjcxMi0zYWEwOGIyOTIwYjQiLCJzdWIiOiJzZyIsImlzcyI6InNnIiwiaWF0IjoxNjM4MTA2NzEyLCJleHAiOjE2MzgxMTAzMTJ9.JVsSbkP94wuczb4QryQbAke3ysBDIL5ou8fWsbt_ebg&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Claims claims <span style=color:#f92672>=</span> parseJWT<span style=color:#f92672>(</span>token<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>claims<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=5><li>用户数据库表和用户实体类</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>sys_user<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> BIGINT(<span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;主键&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>user_name<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;NULL&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;用户名&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>nick_name<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;NULL&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;昵称&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>password<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;NULL&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;密码&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>status<span style=color:#f92672>`</span> CHAR(<span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;账号状态（0正常 1停用）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>email<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>64</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;邮箱&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>phone_number<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;手机号&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>gender<span style=color:#f92672>`</span> CHAR(<span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;用户性别（0女，1男，2未知）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>avatar<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>128</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;头像&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>user_type<span style=color:#f92672>`</span> CHAR(<span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;用户类型（0管理员，1普通用户）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>create_by<span style=color:#f92672>`</span> BIGINT(<span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建人的用户id&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>create_time<span style=color:#f92672>`</span> DATETIME <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建时间&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>update_by<span style=color:#f92672>`</span> BIGINT(<span style=color:#ae81ff>20</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;更新人&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>update_time<span style=color:#f92672>`</span> DATETIME <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;更新时间&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>del_flag<span style=color:#f92672>`</span> INT(<span style=color:#ae81ff>11</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;删除标志（0代表未删除，1代表已删除）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>) ENGINE<span style=color:#f92672>=</span>INNODB AUTO_INCREMENT<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>DEFAULT</span> CHARSET<span style=color:#f92672>=</span>utf8mb4 <span style=color:#66d9ef>COMMENT</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;用户表&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--密码原文存储
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> sys_user(user_name,nick_name,password,status,email,phone_number,gender,avatar,user_type,create_by,create_time,update_by,update_time,del_flag) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span>(<span style=color:#e6db74>&#39;colzry&#39;</span>,<span style=color:#e6db74>&#39;Colzry&#39;</span>,<span style=color:#e6db74>&#39;{noop}123456&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>,<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;colzry@163.com&#39;</span>,<span style=color:#e6db74>&#39;男&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>,<span style=color:#e6db74>&#39;2022-08-01&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>,<span style=color:#e6db74>&#39;2022-08-02&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@TableName</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sys_user&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>implements</span> Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> serialVersionUID <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>40356785423868312L<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 主键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableId</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 用户名
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String userName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 昵称
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String nickName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 密码
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String password<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 账号状态（0正常 1停用）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String status<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 邮箱
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String email<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 手机号
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phoneNumber<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 用户性别（0女，1男，2未知）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 头像
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String avatar<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 用户类型（0管理员，1普通用户）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String userType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 创建人的用户id
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long createBy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 创建时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date createTime<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 更新人
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long updateBy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 更新时间
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date updateTime<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 删除标志（0代表未删除，1代表已删除）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer delFlag<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=243-实现>2.4.3 实现</h4><h5 id=2431-实现userdetailsservice和封装userdetails>2.4.3.1 实现UserDetailsService和封装UserDetails</h5><ol><li>创建User对应的Mapper和Service</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapper</span> <span style=color:#66d9ef>extends</span> BaseMapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserService</span> <span style=color:#66d9ef>extends</span> IService<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserServiceImpl</span> <span style=color:#66d9ef>extends</span> ServiceImpl<span style=color:#f92672>&lt;</span>UserMapper<span style=color:#f92672>,</span> User<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=2><li>实现UserDetailsService</li></ol><p>从之前的分析我们可以知道，我们可以实现一个UserDetailsService,让SpringSecurity使用我们的UserDetailsService。我们自己的UserDetailsService可以从数据库中查询用户名和密码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDetailsServiceImpl</span> <span style=color:#66d9ef>implements</span> UserDetailsService <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserMapper userMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDetails <span style=color:#a6e22e>loadUserByUsername</span><span style=color:#f92672>(</span>String username<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> UsernameNotFoundException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//根据用户名查询用户信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        LambdaQueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LambdaQueryWrapper<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        wrapper<span style=color:#f92672>.</span><span style=color:#a6e22e>eq</span><span style=color:#f92672>(</span>User<span style=color:#f92672>::</span>getUserName<span style=color:#f92672>,</span> username<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> userMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span>wrapper<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//如果查询不到数据就通过抛出异常来给出提示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>isNull</span><span style=color:#f92672>(</span>user<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;用户名或密码错误&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//TODO 根据用户查询权限信息 添加到LoginUser中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//封装成UserDetails对象返回 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> LoginUser<span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ol start=3><li>封装查询用户</li></ol><p>因为UserDetailsService方法的返回值是UserDetails类型，所以需要定义一个类，实现该接口，把用户信息封装在其中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginUser</span> <span style=color:#66d9ef>implements</span> UserDetails <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> User user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> GrantedAuthority<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAuthorities</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getPassword</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getPassword</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUsername</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getUserName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonExpired</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonLocked</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isCredentialsNonExpired</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isEnabled</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>注意：如果要测试，需要往用户表中写入用户数据，并且如果你想让用户的密码是明文存储，需要在密码前加{noop}。例如
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660320316201-61df9a52-e3fa-4df2-89f3-3a773232acc5.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=44&amp;id=u84552a2f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=66&amp;originWidth=830&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=6214&amp;status=done&amp;style=none&amp;taskId=uc469b082-6ae9-4b3d-af90-c917255cacc&amp;title=&amp;width=553.3333333333334" alt=image.png></p><h5 id=2432-配置密码加密>2.4.3.2 配置密码加密</h5><p>我们只需要使用把BCryptPasswordEncoder对象注入Spring容器中，SpringSecurity就会使用该PasswordEncoder来进行密码校验，注意：不要去重写auth配置方法，不然需要在里面重新配置密码加密方式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 不要重写该方法，不然需要重新设置密码加密方式
</span></span></span><span style=display:flex><span><span style=color:#75715e>    @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>    public void configure(AuthenticationManagerBuilder auth) throws Exception {
</span></span></span><span style=display:flex><span><span style=color:#75715e>        // 设置密码加密方式，验证密码的在这里
</span></span></span><span style=display:flex><span><span style=color:#75715e>        auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
</span></span></span><span style=display:flex><span><span style=color:#75715e>    }
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span><span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>编写密码测试，生成密文密码，替换掉数据库中的明文密码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span><span style=color:#f92672>(</span>classes <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>SecurityJWTApplication<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>})</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MapperTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserMapper userMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> PasswordEncoder passwordEncoder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testPassword</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String encode <span style=color:#f92672>=</span> passwordEncoder<span style=color:#f92672>.</span><span style=color:#a6e22e>encode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;123456&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>encode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        LambdaQueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> queryWrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LambdaQueryWrapper<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 查找替换掉数据库中的colzry用户密码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        queryWrapper<span style=color:#f92672>.</span><span style=color:#a6e22e>eq</span><span style=color:#f92672>(</span>User<span style=color:#f92672>::</span>getUserName<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;colzry&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        user<span style=color:#f92672>.</span><span style=color:#a6e22e>setPassword</span><span style=color:#f92672>(</span>encode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        userMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>update</span><span style=color:#f92672>(</span>user<span style=color:#f92672>,</span> queryWrapper<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=2433-编写登录接口>2.4.3.3 编写登录接口</h5><p>接下我们需要自定义登陆接口，然后让SpringSecurity对这个接口放行,让用户访问这个接口的时候不用登录也能访问。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/user&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginController</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> LoginServiceImpl loginService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>login</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@RequestBody</span> User user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> loginService<span style=color:#f92672>.</span><span style=color:#a6e22e>login</span><span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/logout&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>logout</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> loginService<span style=color:#f92672>.</span><span style=color:#a6e22e>logout</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>在接口中我们通过AuthenticationManager的authenticate方法来进行用户认证,所以需要在SecurityConfig配置文件中把AuthenticationManager注入容器。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebSecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        http
</span></span><span style=display:flex><span>                <span style=color:#75715e>//关闭csrf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//不通过Session获取SecurityContext
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>sessionManagement</span><span style=color:#f92672>().</span><span style=color:#a6e22e>sessionCreationPolicy</span><span style=color:#f92672>(</span>SessionCreationPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>STATELESS</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>authorizeRequests</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 对于登录接口 允许匿名访问
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/user/login&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>anonymous</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 除上面外的所有请求全部需要鉴权认证
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>anyRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//把token校验过滤器添加到过滤器链中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        http<span style=color:#f92672>.</span><span style=color:#a6e22e>addFilterBefore</span><span style=color:#f92672>(</span>jwtAuthenticationTokenFilter<span style=color:#f92672>,</span> UsernamePasswordAuthenticationFilter<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 添加密码加密方式到IOC中
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 使用BCrypt加密密码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> AuthenticationManager <span style=color:#a6e22e>authenticationManagerBean</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>authenticationManagerBean</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>认证成功的话要生成一个jwt，放入响应中返回。并且为了让用户下回请求时能通过jwt识别出具体的是哪个用户，我们需要把用户信息存入redis，可以把用户id作为key。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginServiceImpl</span> <span style=color:#66d9ef>implements</span> LoginService <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> AuthenticationManager authenticationManager<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RedisUtil redisUtil<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>login</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// AuthenticationManager authenticate进行用户认证
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        UsernamePasswordAuthenticationToken authenticationToken <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken<span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getUserName</span><span style=color:#f92672>(),</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getPassword</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        Authentication authenticate <span style=color:#f92672>=</span> authenticationManager<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>authenticationToken<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;------AU---------{}&#34;</span><span style=color:#f92672>,</span> authenticate<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 认证没有通过
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>isNull</span><span style=color:#f92672>(</span>authenticate<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;用户名或密码错误&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 认证成功，使用user_id生成token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        LoginUser loginUser <span style=color:#f92672>=</span>  <span style=color:#f92672>(</span>LoginUser<span style=color:#f92672>)</span> authenticate<span style=color:#f92672>.</span><span style=color:#a6e22e>getPrincipal</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        String userId <span style=color:#f92672>=</span> loginUser<span style=color:#f92672>.</span><span style=color:#a6e22e>getUser</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        String jwt <span style=color:#f92672>=</span> JwtUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>createJWT</span><span style=color:#f92672>(</span>userId<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 把authentication存入redis
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        redisUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;login:&#34;</span> <span style=color:#f92672>+</span> userId<span style=color:#f92672>,</span> loginUser<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 把token响应给前端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;token&#34;</span><span style=color:#f92672>,</span> jwt<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Result<span style=color:#f92672>.</span><span style=color:#a6e22e>success</span><span style=color:#f92672>(</span>map<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>logout</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Authentication authentication <span style=color:#f92672>=</span> SecurityContextHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getAuthentication</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        LoginUser loginUser <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>LoginUser<span style=color:#f92672>)</span> authentication<span style=color:#f92672>.</span><span style=color:#a6e22e>getPrincipal</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Long userId <span style=color:#f92672>=</span> loginUser<span style=color:#f92672>.</span><span style=color:#a6e22e>getUser</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        redisUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>del</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;login:&#34;</span> <span style=color:#f92672>+</span> userId<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Result<span style=color:#f92672>.</span><span style=color:#a6e22e>success</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;退出成功&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=2434-添加认证过滤器>2.4.3.4 添加认证过滤器</h5><p>已经在WebSecurityConfig中添加配置，配置代码如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//把token校验过滤器添加到过滤器链中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>http<span style=color:#f92672>.</span><span style=color:#a6e22e>addFilterBefore</span><span style=color:#f92672>(</span>jwtAuthenticationTokenFilter<span style=color:#f92672>,</span> UsernamePasswordAuthenticationFilter<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtAuthenticationTokenFilter</span> <span style=color:#66d9ef>extends</span> OncePerRequestFilter <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RedisUtil redisUtil<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doFilterInternal</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>,</span> FilterChain filterChain<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> ServletException<span style=color:#f92672>,</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 获取token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        String token <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span><span style=color:#a6e22e>getHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;token&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>(</span>token<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 放行，让它被SpringSecurity拦截
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            filterChain<span style=color:#f92672>.</span><span style=color:#a6e22e>doFilter</span><span style=color:#f92672>(</span>request<span style=color:#f92672>,</span> response<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 解析token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        String userId<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Claims claims <span style=color:#f92672>=</span> JwtUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>parseJWT</span><span style=color:#f92672>(</span>token<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            userId <span style=color:#f92672>=</span> claims<span style=color:#f92672>.</span><span style=color:#a6e22e>getSubject</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;token非法&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 从redis中获取用户信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        String redisKey <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;login:&#34;</span> <span style=color:#f92672>+</span> userId<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        LoginUser loginUser <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>LoginUser<span style=color:#f92672>)</span> redisUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>redisKey<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>isNull</span><span style=color:#f92672>(</span>loginUser<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;用户未登录&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//存入SecurityContextHolder
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//TODO 获取权限信息封装到Authentication中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        UsernamePasswordAuthenticationToken authenticationToken <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken<span style=color:#f92672>(</span>loginUser<span style=color:#f92672>,</span><span style=color:#66d9ef>null</span><span style=color:#f92672>,</span><span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//认证通过，将用户信息存入SecurityContextHolder
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        SecurityContextHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setAuthentication</span><span style=color:#f92672>(</span>authenticationToken<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//放行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        filterChain<span style=color:#f92672>.</span><span style=color:#a6e22e>doFilter</span><span style=color:#f92672>(</span>request<span style=color:#f92672>,</span> response<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=2435-演示效果>2.4.3.5 演示效果</h5><blockquote><p>登录</p></blockquote><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660388163694-0cf8d59e-573d-4e02-82ad-3b5f9b2a8e34.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=488&amp;id=uaf2d28f8&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=732&amp;originWidth=1417&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=88965&amp;status=done&amp;style=none&amp;taskId=u485a1ccd-7ff7-4cb6-b07d-91a134bce8e&amp;title=&amp;width=944.6666666666666" alt=image.png></p><blockquote><p>携带token访问</p></blockquote><blockquote><p>登出</p></blockquote><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660388282333-350e59aa-4e51-41c8-9c3e-1fb7021e5a0b.png#clientId=u07cc47ad-e43a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=499&amp;id=u5f770c82&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=749&amp;originWidth=1421&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=84253&amp;status=done&amp;style=none&amp;taskId=u2f30a83c-cb14-4551-8057-95ee8d3aa42&amp;title=&amp;width=947.3333333333334" alt=image.png></p><h2 id=3-授权>3. 授权</h2><h3 id=31-rbac权限模型>3.1 RBAC权限模型</h3><p>在RBAC模型里面，有3个基础组成部分，分别是：<strong>用户</strong>、<strong>角色</strong>和<strong>权限</strong>
RBAC通过定义角色的权限，并对用户授予某个角色从而来控制用户的权限，实现了用户和权限的逻辑分离
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660651762625-0f724ec1-af7e-481b-929d-fa6ebc5894dc.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=131&amp;id=ud4c2fc43&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=197&amp;originWidth=829&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=68809&amp;status=done&amp;style=none&amp;taskId=u7da21edc-91ba-4e35-93af-b0cf93e20d7&amp;title=&amp;width=552.6666666666666" alt=image.png>
<strong>将权限颗粒化，绑定给不同的角色，从而将角色授权给用户</strong>
例如图书管理系统
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660652496584-5d06cef2-a903-48ce-9933-d8f84b097b5e.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=367&amp;id=u135ded24&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=550&amp;originWidth=1030&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=307702&amp;status=done&amp;style=none&amp;taskId=u3d6c252b-f39d-44c2-b890-67c46c07d9a&amp;title=&amp;width=686.6666666666666" alt=image.png>
RBAC支持三个著名的安全原则：最小权限原则、责任分离原则和数据抽象原则</p><ul><li>最小权限原则：RBAC可以将角色配置成其完成任务所需的最小权限集合</li><li>责任分离原则：可以通过调用相互独立互斥的角色来共同完成敏感的任务，例如要求一个计账员和财务管理员共同参与统一过账操作</li><li>数据抽象原则：可以通过权限的抽象来体现，例如财务操作用借款、存款等抽象权限，而不是使用典型的读、写、执行权限</li></ul><h3 id=32-授权实现>3.2 授权实现</h3><h4 id=321-限制访问资源的权限>3.2.1 限制访问资源的权限</h4><p>SpringSecurity为我们提供了基于注解的权限控制方案，这也是我们项目中主要采用的方式。我们可以使用注解去指定访问对应的资源所需的权限。
但是要使用它我们需要先开启相关配置springSecurity里面添加</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@EnableGlobalMethodSecurity</span><span style=color:#f92672>(</span>prePostEnabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660652825078-6e8f9889-64fb-4cc5-90c2-ec618405aa7d.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=92&amp;id=u91f42dda&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=138&amp;originWidth=1037&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25098&amp;status=done&amp;style=none&amp;taskId=u34c13cae-666b-475b-89ea-faaaf7a202b&amp;title=&amp;width=691.3333333333334" alt=image.png></p><h4 id=322-封装权限信息>3.2.2 封装权限信息</h4><ol><li>之前定义了UserDetails的实现类LoginUser，想要让其能封装权限信息就要对其进行修改</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginUser</span> <span style=color:#66d9ef>implements</span> UserDetails <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> User user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//存储权限信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> permissions<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//存储SpringSecurity所需要的权限信息的集合
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@JSONField</span><span style=color:#f92672>(</span>serialize <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> deserialize <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span> <span style=color:#75715e>// 不对此字段序列化和反序列化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>SimpleGrantedAuthority<span style=color:#f92672>&gt;</span> authorities<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>LoginUser</span><span style=color:#f92672>(</span>User user<span style=color:#f92672>,</span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> permissions<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>permissions</span> <span style=color:#f92672>=</span> permissions<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> GrantedAuthority<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAuthorities</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>authorities<span style=color:#f92672>!=</span><span style=color:#66d9ef>null</span><span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> authorities<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//把permissions中字符串类型的权限信息转换成SimpleGrantedAuthority对象存入authorities中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        authorities <span style=color:#f92672>=</span> permissions<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>().</span>
</span></span><span style=display:flex><span>                map<span style=color:#f92672>(</span>SimpleGrantedAuthority<span style=color:#f92672>::</span><span style=color:#66d9ef>new</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toList</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> authorities<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getPassword</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getPassword</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUsername</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getUserName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonExpired</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isAccountNonLocked</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isCredentialsNonExpired</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isEnabled</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660653225953-210fd150-f420-49f1-99b1-420d9e7f4267.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=538&amp;id=ue2a1e50a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=807&amp;originWidth=1208&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=131744&amp;status=done&amp;style=none&amp;taskId=ub174f6ac-790c-4d79-a551-1e76c7b6345&amp;title=&amp;width=805.3333333333334" alt=image.png></p><ol start=2><li>LoginUser修改完后我们就可以在UserDetailsServiceImpl中去把权限信息封装到LoginUser中了。我们写死权限进行测试，后面我们再从数据库中查询权限信息。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDetailsServiceImpl</span> <span style=color:#66d9ef>implements</span> UserDetailsService <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserMapper userMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDetails <span style=color:#a6e22e>loadUserByUsername</span><span style=color:#f92672>(</span>String username<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> UsernameNotFoundException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//根据用户名查询用户信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        LambdaQueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LambdaQueryWrapper<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        wrapper<span style=color:#f92672>.</span><span style=color:#a6e22e>eq</span><span style=color:#f92672>(</span>User<span style=color:#f92672>::</span>getUserName<span style=color:#f92672>,</span> username<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> userMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>selectOne</span><span style=color:#f92672>(</span>wrapper<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//如果查询不到数据就通过抛出异常来给出提示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>Objects<span style=color:#f92672>.</span><span style=color:#a6e22e>isNull</span><span style=color:#f92672>(</span>user<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;用户名或密码错误&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//TODO 根据用户查询权限信息 添加到LoginUser中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;(</span>Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>asList</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//封装成UserDetails对象返回
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> LoginUser<span style=color:#f92672>(</span>user<span style=color:#f92672>,</span> list<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660653393521-b59c4be4-2086-4694-9ada-4e6cb5c2608d.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=133&amp;id=u10b74e00&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=200&amp;originWidth=908&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=34712&amp;status=done&amp;style=none&amp;taskId=u4675aa71-e1c5-4983-9ccd-430b9fb11f9&amp;title=&amp;width=605.3333333333334" alt=image.png></p><ol start=3><li>在JwtAuthenticationTokenFilter把LoginUser的权限信息封装给SecurityContextHolder</li></ol><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660658082269-09411fda-30c3-4424-ad93-fd72c6334fb4.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=153&amp;id=u3a00749d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=229&amp;originWidth=1451&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=65659&amp;status=done&amp;style=none&amp;taskId=u7a80174e-524a-46ae-b3f1-2c05b3c985d&amp;title=&amp;width=967.3333333333334" alt=image.png></p><ol start=4><li>测试一下</li></ol><p>添加@PreAuthorize注解，需要让访问的用户拥有指定的权限才能访问</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/hello&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestController</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;{name}&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PreAuthorize</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hasAuthority(&#39;test&#39;)&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getHello</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@PathVariable</span> String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>上面已经封装了固定的test权限，让封装的用户进行访问
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660657311333-3d74220a-356d-4a20-86bf-e3ddb799dc55.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=339&amp;id=uc7cb4c07&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=508&amp;originWidth=1423&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=64519&amp;status=done&amp;style=none&amp;taskId=u1d30157f-14e8-4ebb-86fe-4e36f831029&amp;title=&amp;width=948.6666666666666" alt=image.png>
更改访问权限后再次访问
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660657365795-bedc0bdd-3b7b-43c4-8851-116ccb62fcf9.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=229&amp;id=u0bd5ab28&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=343&amp;originWidth=960&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46521&amp;status=done&amp;style=none&amp;taskId=uc6246df8-2e69-4d4f-97d4-2222925dd52&amp;title=&amp;width=640" alt=image.png>
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660657402951-03d59d00-3ff3-446d-9e95-767aed78f138.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=373&amp;id=u3bccf39e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=560&amp;originWidth=1417&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=70547&amp;status=done&amp;style=none&amp;taskId=ua8f8d4a2-6a18-49ff-ba77-7b2cdbbc60b&amp;title=&amp;width=944.6666666666666" alt=image.png></p><ol start=5><li>也可以在Security配置类中配置访问权限</li></ol><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660657739154-bc90d9fb-43be-4425-941a-577470ddf820.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=133&amp;id=uccb2585d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=199&amp;originWidth=1003&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=38226&amp;status=done&amp;style=none&amp;taskId=u574d0790-13b7-44a9-8d5c-ac8de548901&amp;title=&amp;width=668.6666666666666" alt=image.png>
anonymous() 允许匿名用户访问,不允许已登入用户访问
permitAll() 不管登入,不登入 都能访问</p><h3 id=33-封装从数据库中查询的权限信息>3.3 封装从数据库中查询的权限信息</h3><p>建立的数据库模型如下，采用RBAC权限模型（参考3.1），多对多的关系需要使用另外的一张表进行连接，变为一对多的关系
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660663485295-c9e9db03-113d-4367-afb3-b0e53fa5ba35.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=589&amp;id=u03f8cc8f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=883&amp;originWidth=1110&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=465851&amp;status=done&amp;style=none&amp;taskId=ub4963a93-03a5-4f59-9fe2-3980f7b1410&amp;title=&amp;width=740" alt=image.png></p><h4 id=331-mysql数据表>3.3.1 MySql数据表</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>NAMES</span> utf8mb4;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> FOREIGN_KEY_CHECKS <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Table structure for sys_menu
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span>  (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>menu_name<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>64</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;NULL&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;菜单名&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>path<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>200</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;路由地址&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>component<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>255</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;组件路径&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>visible<span style=color:#f92672>`</span> char(<span style=color:#ae81ff>1</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;菜单状态（0显示 1隐藏）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>status<span style=color:#f92672>`</span> char(<span style=color:#ae81ff>1</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;菜单状态（0正常 1停用）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>perms<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>100</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;权限标识&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>icon<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>100</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;#&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;菜单图标&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>create_by<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>create_time<span style=color:#f92672>`</span> datetime(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>update_by<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>update_time<span style=color:#f92672>`</span> datetime(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>del_flag<span style=color:#f92672>`</span> int(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;是否删除（0未删除 1已删除）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>remark<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>500</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;备注&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>USING</span> BTREE
</span></span><span style=display:flex><span>) ENGINE <span style=color:#f92672>=</span> InnoDB AUTO_INCREMENT <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> CHARACTER <span style=color:#66d9ef>SET</span> <span style=color:#f92672>=</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> <span style=color:#f92672>=</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>COMMENT</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;菜单表&#39;</span> ROW_FORMAT <span style=color:#f92672>=</span> <span style=color:#66d9ef>Dynamic</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Records of sys_menu
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;查询图书列表&#39;</span>, <span style=color:#e6db74>&#39;system/book/list&#39;</span>, <span style=color:#e6db74>&#39;book&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system📖list&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;添加图书&#39;</span>, <span style=color:#e6db74>&#39;system/book/add&#39;</span>, <span style=color:#e6db74>&#39;book&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system📖add&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;删除图书&#39;</span>, <span style=color:#e6db74>&#39;system/book/delete&#39;</span>, <span style=color:#e6db74>&#39;book&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system📖delete&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>5</span>, <span style=color:#e6db74>&#39;借阅图书&#39;</span>, <span style=color:#e6db74>&#39;system/book/borrow&#39;</span>, <span style=color:#e6db74>&#39;book&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system📖borrow&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>6</span>, <span style=color:#e6db74>&#39;修改用户信息&#39;</span>, <span style=color:#e6db74>&#39;system/user/update&#39;</span>, <span style=color:#e6db74>&#39;user&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system:user:update&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>7</span>, <span style=color:#e6db74>&#39;添加用户信息&#39;</span>, <span style=color:#e6db74>&#39;system/user/add&#39;</span>, <span style=color:#e6db74>&#39;user&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system:user:add&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>&#39;删除用户信息&#39;</span>, <span style=color:#e6db74>&#39;system/user/delete&#39;</span>, <span style=color:#e6db74>&#39;user&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system:user:delete&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>9</span>, <span style=color:#e6db74>&#39;查询用户信息&#39;</span>, <span style=color:#e6db74>&#39;system/user/query&#39;</span>, <span style=color:#e6db74>&#39;user&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;system:user:query&#39;</span>, <span style=color:#e6db74>&#39;#&#39;</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Table structure for sys_role
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#f92672>`</span>sys_role<span style=color:#f92672>`</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>sys_role<span style=color:#f92672>`</span>  (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>128</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>role_key<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>100</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;角色权限字符串&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>status<span style=color:#f92672>`</span> char(<span style=color:#ae81ff>1</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;角色状态（0正常 1停用）&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>del_flag<span style=color:#f92672>`</span> int(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;del_flag&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>create_by<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>create_time<span style=color:#f92672>`</span> datetime(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>update_by<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>update_time<span style=color:#f92672>`</span> datetime(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>remark<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>500</span>) CHARACTER <span style=color:#66d9ef>SET</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;备注&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>USING</span> BTREE
</span></span><span style=display:flex><span>) ENGINE <span style=color:#f92672>=</span> InnoDB AUTO_INCREMENT <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> CHARACTER <span style=color:#66d9ef>SET</span> <span style=color:#f92672>=</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> <span style=color:#f92672>=</span> utf8mb4_0900_ai_ci <span style=color:#66d9ef>COMMENT</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;角色表&#39;</span> ROW_FORMAT <span style=color:#f92672>=</span> <span style=color:#66d9ef>Dynamic</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Records of sys_role
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;普通用户&#39;</span>, <span style=color:#e6db74>&#39;ROLE_consumer&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;图书管理员&#39;</span>, <span style=color:#e6db74>&#39;ROLE_librarian&#39;</span>, <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>, <span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Table structure for sys_role_menu
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span>  (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;角色ID&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>menu_id<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;菜单id&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>menu_id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>USING</span> BTREE
</span></span><span style=display:flex><span>) ENGINE <span style=color:#f92672>=</span> InnoDB AUTO_INCREMENT <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> CHARACTER <span style=color:#66d9ef>SET</span> <span style=color:#f92672>=</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> <span style=color:#f92672>=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span style=color:#f92672>=</span> <span style=color:#66d9ef>Dynamic</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Records of sys_role_menu
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>9</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>7</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>8</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>9</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Table structure for sys_user_role
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> <span style=color:#f92672>`</span>sys_user_role<span style=color:#f92672>`</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>sys_user_role<span style=color:#f92672>`</span>  (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>user_id<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;用户id&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span> bigint(<span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;角色id&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>user_id<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>USING</span> BTREE
</span></span><span style=display:flex><span>) ENGINE <span style=color:#f92672>=</span> InnoDB CHARACTER <span style=color:#66d9ef>SET</span> <span style=color:#f92672>=</span> utf8mb4 <span style=color:#66d9ef>COLLATE</span> <span style=color:#f92672>=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span style=color:#f92672>=</span> <span style=color:#66d9ef>Dynamic</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- Records of sys_user_role
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_user_role<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>`</span>sys_user_role<span style=color:#f92672>`</span> <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> FOREIGN_KEY_CHECKS <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><p>通过sys_user的id查询用户所拥有的权限</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>DISTINCT</span> m.<span style=color:#f92672>`</span>perms<span style=color:#f92672>`</span> <span style=color:#66d9ef>as</span> <span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>权限</span><span style=color:#f92672>`</span>, r.<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>as</span> <span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>角色</span><span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>	sys_user_role ur
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>sys_role<span style=color:#f92672>`</span> r <span style=color:#66d9ef>ON</span> ur.<span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> r.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>sys_role_menu<span style=color:#f92672>`</span> rm <span style=color:#66d9ef>ON</span> ur.<span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> rm.<span style=color:#f92672>`</span>role_id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>JOIN</span> <span style=color:#f92672>`</span>sys_menu<span style=color:#f92672>`</span> m <span style=color:#66d9ef>ON</span> m.<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> <span style=color:#f92672>=</span> rm.<span style=color:#f92672>`</span>menu_id<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span>
</span></span><span style=display:flex><span>	user_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><h4 id=332-代码实现>3.3.2 代码实现</h4><p>添加权限单实体类</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@TableName</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sys_menu&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@JsonInclude</span><span style=color:#f92672>(</span>JsonInclude<span style=color:#f92672>.</span><span style=color:#a6e22e>Include</span><span style=color:#f92672>.</span><span style=color:#a6e22e>NON_NULL</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Menu</span> <span style=color:#66d9ef>implements</span> Serializable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> serialVersionUID <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>54979041104113736L<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableId</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 菜单名
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String menuName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 路由地址
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String path<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 组件路径
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String component<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 菜单状态（0显示 1隐藏）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String visible<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 菜单状态（0正常 1停用）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String status<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 权限标识
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String perms<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 菜单图标
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String icon<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long createBy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date createTime<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long updateBy<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date updateTime<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 是否删除（0未删除 1已删除）
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer delFlag<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 备注
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String remark<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>添加通过sys_user的id查询用户所拥有的权限的方法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Mapper</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>MenuMapper</span> <span style=color:#66d9ef>extends</span> BaseMapper<span style=color:#f92672>&lt;</span>Menu<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectPermsByUserId</span><span style=color:#f92672>(</span>Long id<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34; &gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;mapper</span> <span style=color:#a6e22e>namespace=</span><span style=color:#e6db74>&#34;com.securityJWT.mapper.MenuMapper&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;selectPermsByUserId&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;java.lang.String&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        SELECT
</span></span><span style=display:flex><span>	        DISTINCT m.`perms`
</span></span><span style=display:flex><span>        FROM
</span></span><span style=display:flex><span>            sys_user_role ur
</span></span><span style=display:flex><span>        LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id`
</span></span><span style=display:flex><span>        LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`
</span></span><span style=display:flex><span>        LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`
</span></span><span style=display:flex><span>        WHERE
</span></span><span style=display:flex><span>	        user_id = #{id}
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/mapper&gt;</span>
</span></span></code></pre></div><p>更改UserDetailsService实现类的查询，将用户权限封装进LoginUser</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MenuMapper menuMapper<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> perms <span style=color:#f92672>=</span> menuMapper<span style=color:#f92672>.</span><span style=color:#a6e22e>selectPermsByUserId</span><span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>());</span>
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660661488203-60d12728-54fd-458f-a68b-481d8c5ffac9.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=196&amp;id=ufab11f1b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=294&amp;originWidth=1074&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32906&amp;status=done&amp;style=none&amp;taskId=u894fd238-95c0-465b-ae19-e5ffc551a39&amp;title=&amp;width=716" alt=image.png>
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660661525263-6d1f6c2a-8531-406a-bbb5-f5ca2f6b289c.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=428&amp;id=ub5faadc7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=642&amp;originWidth=1334&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=128546&amp;status=done&amp;style=none&amp;taskId=uba93c53f-034a-4b63-9358-efe5d01f090&amp;title=&amp;width=889.3333333333334" alt=image.png></p><h4 id=333-权限测试>3.3.3 权限测试</h4><p>当前接口所需要的权限
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660662846792-2e66284f-5c05-47ea-a78d-8bf9ae086343.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=194&amp;id=u03114852&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=291&amp;originWidth=1303&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46522&amp;status=done&amp;style=none&amp;taskId=u95fcfb01-c425-44fa-a17d-6cc263ef088&amp;title=&amp;width=868.6666666666666" alt=image.png>
当前用户所拥有的权限
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660662966044-0637d1a0-757d-4357-802a-c7cfd69697ee.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=283&amp;id=ua4748f1e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=425&amp;originWidth=1093&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=54147&amp;status=done&amp;style=none&amp;taskId=uccd7e6bd-98f2-427d-b473-bed23b5601d&amp;title=&amp;width=728.6666666666666" alt=image.png>
对该接口进行访问，可以访问成功
<img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660663041953-07e16fee-57a5-47dc-86fe-d6acd0f921a5.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=364&amp;id=ue3e094e2&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=546&amp;originWidth=1408&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=73397&amp;status=done&amp;style=none&amp;taskId=u2f16055a-9cb2-4f3e-b85b-e2f8d359d0d&amp;title=&amp;width=938.6666666666666" alt=image.png></p><h3 id=34-自定义失败处理>3.4 自定义失败处理</h3><p>如果是认证过程中出现的异常会被封装成AuthenticationException然后调用AuthenticationEntryPoint对象的方法去进行异常处理。
如果是授权过程中出现的异常会被封装成AccessDeniedException然后调用AccessDeniedHandler对象的方法去进行异常处理。
所以如果我们需要自定义异常处理，我们只需要自定义AuthenticationEntryPoint和AccessDeniedHandler然后配置给SpringSecurity即可。</p><h4 id=341-自定义实现类>3.4.1 自定义实现类</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AccessDeniedHandlerImpl</span> <span style=color:#66d9ef>implements</span> AccessDeniedHandler <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>,</span> AccessDeniedException e<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>,</span> ServletException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ResponseUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>sendMsg</span><span style=color:#f92672>(</span>response<span style=color:#f92672>,</span> HttpStatus<span style=color:#f92672>.</span><span style=color:#a6e22e>FORBIDDEN</span><span style=color:#f92672>.</span><span style=color:#a6e22e>value</span><span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;权限不足&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticationEntryPointImpl</span> <span style=color:#66d9ef>implements</span> AuthenticationEntryPoint <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>commence</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>,</span> AuthenticationException e<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>,</span> ServletException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ResponseUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>sendMsg</span><span style=color:#f92672>(</span>response<span style=color:#f92672>,</span> HttpStatus<span style=color:#f92672>.</span><span style=color:#a6e22e>UNAUTHORIZED</span><span style=color:#f92672>.</span><span style=color:#a6e22e>value</span><span style=color:#f92672>(),</span> <span style=color:#e6db74>&#34;认证失败请重新登录&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ResponseUtil</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>tokenExpire</span><span style=color:#f92672>(</span>HttpServletResponse response<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Access-Control-Allow-Origin&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;*&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Cache-Control&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;no-cache&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setCharacterEncoding</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;UTF-8&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setContentType</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;application/json&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;code&#34;</span><span style=color:#f92672>,</span> 401<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;data&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Full authentication is required to access this resource&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;message&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;token已过期&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ServletOutputStream output <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>getOutputStream</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        output<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>JSON<span style=color:#f92672>.</span><span style=color:#a6e22e>toJSONBytes</span><span style=color:#f92672>(</span>map<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        output<span style=color:#f92672>.</span><span style=color:#a6e22e>flush</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>sendMsg</span><span style=color:#f92672>(</span>HttpServletResponse response<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> httpStatus<span style=color:#f92672>,</span> String msg<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Access-Control-Allow-Origin&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;*&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setHeader</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Cache-Control&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;no-cache&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setCharacterEncoding</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;UTF-8&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        response<span style=color:#f92672>.</span><span style=color:#a6e22e>setContentType</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;application/json&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;code&#34;</span><span style=color:#f92672>,</span> httpStatus<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;message&#34;</span><span style=color:#f92672>,</span> msg<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        ServletOutputStream output <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span><span style=color:#a6e22e>getOutputStream</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        output<span style=color:#f92672>.</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>JSON<span style=color:#f92672>.</span><span style=color:#a6e22e>toJSONBytes</span><span style=color:#f92672>(</span>map<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        output<span style=color:#f92672>.</span><span style=color:#a6e22e>flush</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=342-配置给springsecurity>3.4.2 配置给SpringSecurity</h4><p>先注入对应的处理器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> AccessDeniedHandlerImpl accessDeniedHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> AuthenticationEntryPointImpl authenticationEntryPoint<span style=color:#f92672>;</span>
</span></span></code></pre></div><p>使用HttpSecurity对象的方法去配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 自定义失败处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>http<span style=color:#f92672>.</span><span style=color:#a6e22e>exceptionHandling</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authenticationEntryPoint</span><span style=color:#f92672>(</span>authenticationEntryPoint<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span><span style=color:#a6e22e>accessDeniedHandler</span><span style=color:#f92672>(</span>accessDeniedHandler<span style=color:#f92672>);</span>
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660664101051-bc888639-e2ee-45fd-b7ac-40968c2892a9.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=271&amp;id=u07ab1b8e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=406&amp;originWidth=1376&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=66407&amp;status=done&amp;style=none&amp;taskId=u5961630a-8e5c-4e05-adba-48b4aecb7d9&amp;title=&amp;width=917.3333333333334" alt=image.png><img src=/imgs/img-lazy-loading.gif data-src="https://cdn.nlark.com/yuque/0/2022/png/22223333/1660664123782-916be2a9-fdc6-4179-ab3e-e990c73ebb1a.png#clientId=u376b5a7a-5be9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=158&amp;id=uf2f58cff&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=237&amp;originWidth=1355&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=43462&amp;status=done&amp;style=none&amp;taskId=u75949175-7569-468b-b0ca-45c45502ff3&amp;title=&amp;width=903.3333333333334" alt=image.png></p><h3 id=35-其他处理器>3.5 其他处理器</h3><h4 id=351-认证成功和认证失败处理器>3.5.1 认证成功和认证失败处理器</h4><p>AuthenticationSuccessHandler
AuthenticationFailureHandler
实现并重写上面的接口，之后在Security配置类中配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>http<span style=color:#f92672>.</span><span style=color:#a6e22e>formLogin</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 配置认证成功处理器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>.</span><span style=color:#a6e22e>successHandler</span><span style=color:#f92672>(</span>successHandler<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 配置认证失败处理器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>.</span><span style=color:#a6e22e>failureHandler</span><span style=color:#f92672>(</span>failureHandler<span style=color:#f92672>);</span>
</span></span></code></pre></div><h4 id=352-注销成功处理器>3.5.2 注销成功处理器</h4><p>LogoutSuccessHandler
实现并重写上面的接口，之后在Security配置类中配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>http<span style=color:#f92672>.</span><span style=color:#a6e22e>logout</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//配置注销成功处理器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>.</span><span style=color:#a6e22e>logoutSuccessHandler</span><span style=color:#f92672>(</span>logoutSuccessHandler<span style=color:#f92672>);</span>
</span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/springsecurity>SpringSecurity</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="Colzry - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="Colzry - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
SpringSecurity入门</li><li class=post-copyright-author><strong>本文作者：</strong>
Colzry</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blog.colzry.tk/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/springsecurity/ title=SpringSecurity入门>https://blog.colzry.tk/posts/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/springsecurity/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/posts/redis/springboot%E6%95%B4%E5%90%88redis/ rel=next title=SpringBoot整合Redis><i class="fa fa-chevron-left"></i> SpringBoot整合Redis</a></div><div class="post-nav-prev post-nav-item"><a href=/posts/ssh/ssh%E9%98%B2%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/ rel=prev title=SSH防暴力破解>SSH防暴力破解
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Colzry</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.116.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.1 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel></a>
<a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云></a>
<a target=_blank href=https://webify.cloudbase.net title=Webify>Webify</a>
<span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://blog.colzry.tk/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.37028fbafbd97fd89808b4c7b5a3a81f01ed0ab24001d273d774f9546a0e9170.js defer></script></body></html>